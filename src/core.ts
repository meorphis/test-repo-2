aW1wb3J0IHsgVkVSU0lPTiB9IGZyb20gJy4vdmVyc2lvbic7CmltcG9ydCB7
CiAgTWVvcnBoaXNUZXN0NEVycm9yLAogIEFQSUVycm9yLAogIEFQSUNvbm5l
Y3Rpb25FcnJvciwKICBBUElDb25uZWN0aW9uVGltZW91dEVycm9yLAogIEFQ
SVVzZXJBYm9ydEVycm9yLAp9IGZyb20gJy4vZXJyb3InOwppbXBvcnQgewog
IGtpbmQgYXMgc2hpbXNLaW5kLAogIHR5cGUgUmVhZGFibGUsCiAgZ2V0RGVm
YXVsdEFnZW50LAogIHR5cGUgQWdlbnQsCiAgZmV0Y2gsCiAgdHlwZSBSZXF1
ZXN0SW5mbywKICB0eXBlIFJlcXVlc3RJbml0LAogIHR5cGUgUmVzcG9uc2Us
CiAgdHlwZSBIZWFkZXJzSW5pdCwKfSBmcm9tICcuL19zaGltcy9pbmRleCc7
CmV4cG9ydCB7IHR5cGUgUmVzcG9uc2UgfTsKaW1wb3J0IHsgaXNNdWx0aXBh
cnRCb2R5IH0gZnJvbSAnLi91cGxvYWRzJzsKZXhwb3J0IHsKICBtYXliZU11
bHRpcGFydEZvcm1SZXF1ZXN0T3B0aW9ucywKICBtdWx0aXBhcnRGb3JtUmVx
dWVzdE9wdGlvbnMsCiAgY3JlYXRlRm9ybSwKICB0eXBlIFVwbG9hZGFibGUs
Cn0gZnJvbSAnLi91cGxvYWRzJzsKCmV4cG9ydCB0eXBlIEZldGNoID0gKHVy
bDogUmVxdWVzdEluZm8sIGluaXQ/OiBSZXF1ZXN0SW5pdCkgPT4gUHJvbWlz
ZTxSZXNwb25zZT47Cgp0eXBlIFByb21pc2VPclZhbHVlPFQ+ID0gVCB8IFBy
b21pc2U8VD47Cgp0eXBlIEFQSVJlc3BvbnNlUHJvcHMgPSB7CiAgcmVzcG9u
c2U6IFJlc3BvbnNlOwogIG9wdGlvbnM6IEZpbmFsUmVxdWVzdE9wdGlvbnM7
CiAgY29udHJvbGxlcjogQWJvcnRDb250cm9sbGVyOwp9OwoKYXN5bmMgZnVu
Y3Rpb24gZGVmYXVsdFBhcnNlUmVzcG9uc2U8VD4ocHJvcHM6IEFQSVJlc3Bv
bnNlUHJvcHMpOiBQcm9taXNlPFQ+IHsKICBjb25zdCB7IHJlc3BvbnNlIH0g
PSBwcm9wczsKICAvLyBmZXRjaCByZWZ1c2VzIHRvIHJlYWQgdGhlIGJvZHkg
d2hlbiB0aGUgc3RhdHVzIGNvZGUgaXMgMjA0LgogIGlmIChyZXNwb25zZS5z
dGF0dXMgPT09IDIwNCkgewogICAgcmV0dXJuIG51bGwgYXMgVDsKICB9Cgog
IGlmIChwcm9wcy5vcHRpb25zLl9fYmluYXJ5UmVzcG9uc2UpIHsKICAgIHJl
dHVybiByZXNwb25zZSBhcyB1bmtub3duIGFzIFQ7CiAgfQoKICBjb25zdCBj
b250ZW50VHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5
cGUnKTsKICBpZiAoY29udGVudFR5cGU/LmluY2x1ZGVzKCdhcHBsaWNhdGlv
bi9qc29uJykpIHsKICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5q
c29uKCk7CgogICAgZGVidWcoJ3Jlc3BvbnNlJywgcmVzcG9uc2Uuc3RhdHVz
LCByZXNwb25zZS51cmwsIHJlc3BvbnNlLmhlYWRlcnMsIGpzb24pOwoKICAg
IHJldHVybiBqc29uIGFzIFQ7CiAgfQoKICBjb25zdCB0ZXh0ID0gYXdhaXQg
cmVzcG9uc2UudGV4dCgpOwogIGRlYnVnKCdyZXNwb25zZScsIHJlc3BvbnNl
LnN0YXR1cywgcmVzcG9uc2UudXJsLCByZXNwb25zZS5oZWFkZXJzLCB0ZXh0
KTsKCiAgLy8gVE9ETyBoYW5kbGUgYmxvYiwgYXJyYXlidWZmZXIsIG90aGVy
IGNvbnRlbnQgdHlwZXMsIGV0Yy4KICByZXR1cm4gdGV4dCBhcyB1bmtub3du
IGFzIFQ7Cn0KCi8qKgogKiBBIHN1YmNsYXNzIG9mIGBQcm9taXNlYCBwcm92
aWRpbmcgYWRkaXRpb25hbCBoZWxwZXIgbWV0aG9kcwogKiBmb3IgaW50ZXJh
Y3Rpbmcgd2l0aCB0aGUgU0RLLgogKi8KZXhwb3J0IGNsYXNzIEFQSVByb21p
c2U8VD4gZXh0ZW5kcyBQcm9taXNlPFQ+IHsKICBwcml2YXRlIHBhcnNlZFBy
b21pc2U6IFByb21pc2U8VD4gfCB1bmRlZmluZWQ7CgogIGNvbnN0cnVjdG9y
KAogICAgcHJpdmF0ZSByZXNwb25zZVByb21pc2U6IFByb21pc2U8QVBJUmVz
cG9uc2VQcm9wcz4sCiAgICBwcml2YXRlIHBhcnNlUmVzcG9uc2U6IChwcm9w
czogQVBJUmVzcG9uc2VQcm9wcykgPT4gUHJvbWlzZU9yVmFsdWU8VD4gPSBk
ZWZhdWx0UGFyc2VSZXNwb25zZSwKICApIHsKICAgIHN1cGVyKChyZXNvbHZl
KSA9PiB7CiAgICAgIC8vIHRoaXMgaXMgbWF5YmUgYSBiaXQgd2VpcmQgYnV0
IHRoaXMgaGFzIHRvIGJlIGEgbm8tb3AgdG8gbm90IGltcGxpY2l0bHkKICAg
ICAgLy8gcGFyc2UgdGhlIHJlc3BvbnNlIGJvZHk7IGluc3RlYWQgLnRoZW4s
IC5jYXRjaCwgLmZpbmFsbHkgYXJlIG92ZXJyaWRkZW4KICAgICAgLy8gdG8g
cGFyc2UgdGhlIHJlc3BvbnNlCiAgICAgIHJlc29sdmUobnVsbCBhcyBhbnkp
OwogICAgfSk7CiAgfQoKICBfdGhlblVud3JhcDxVPih0cmFuc2Zvcm06IChk
YXRhOiBUKSA9PiBVKTogQVBJUHJvbWlzZTxVPiB7CiAgICByZXR1cm4gbmV3
IEFQSVByb21pc2UodGhpcy5yZXNwb25zZVByb21pc2UsIGFzeW5jIChwcm9w
cykgPT4gdHJhbnNmb3JtKGF3YWl0IHRoaXMucGFyc2VSZXNwb25zZShwcm9w
cykpKTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHJhdyBgUmVzcG9uc2Vg
IGluc3RhbmNlIGluc3RlYWQgb2YgcGFyc2luZyB0aGUgcmVzcG9uc2UKICAg
KiBkYXRhLgogICAqCiAgICogSWYgeW91IHdhbnQgdG8gcGFyc2UgdGhlIHJl
c3BvbnNlIGJvZHkgYnV0IHN0aWxsIGdldCB0aGUgYFJlc3BvbnNlYAogICAq
IGluc3RhbmNlLCB5b3UgY2FuIHVzZSB7QGxpbmsgd2l0aFJlc3BvbnNlKCl9
LgogICAqCiAgICog8J+RiyBHZXR0aW5nIHRoZSB3cm9uZyBUeXBlU2NyaXB0
IHR5cGUgZm9yIGBSZXNwb25zZWA/CiAgICogVHJ5IHNldHRpbmcgYCJtb2R1
bGVSZXNvbHV0aW9uIjogIk5vZGVOZXh0ImAgaWYgeW91IGNhbiwKICAgKiBv
ciBhZGQgb25lIG9mIHRoZXNlIGltcG9ydHMgYmVmb3JlIHlvdXIgZmlyc3Qg
YGltcG9ydCDigKYgZnJvbSAnbWVvcnBoaXMtdGVzdC00J2A6CiAgICogLSBg
aW1wb3J0ICdtZW9ycGhpcy10ZXN0LTQvc2hpbXMvbm9kZSdgIChpZiB5b3Un
cmUgcnVubmluZyBvbiBOb2RlKQogICAqIC0gYGltcG9ydCAnbWVvcnBoaXMt
dGVzdC00L3NoaW1zL3dlYidgIChvdGhlcndpc2UpCiAgICovCiAgYXNSZXNw
b25zZSgpOiBQcm9taXNlPFJlc3BvbnNlPiB7CiAgICByZXR1cm4gdGhpcy5y
ZXNwb25zZVByb21pc2UudGhlbigocCkgPT4gcC5yZXNwb25zZSk7CiAgfQog
IC8qKgogICAqIEdldHMgdGhlIHBhcnNlZCByZXNwb25zZSBkYXRhIGFuZCB0
aGUgcmF3IGBSZXNwb25zZWAgaW5zdGFuY2UuCiAgICoKICAgKiBJZiB5b3Ug
anVzdCB3YW50IHRvIGdldCB0aGUgcmF3IGBSZXNwb25zZWAgaW5zdGFuY2Ug
d2l0aG91dCBwYXJzaW5nIGl0LAogICAqIHlvdSBjYW4gdXNlIHtAbGluayBh
c1Jlc3BvbnNlKCl9LgogICAqCiAgICoKICAgKiDwn5GLIEdldHRpbmcgdGhl
IHdyb25nIFR5cGVTY3JpcHQgdHlwZSBmb3IgYFJlc3BvbnNlYD8KICAgKiBU
cnkgc2V0dGluZyBgIm1vZHVsZVJlc29sdXRpb24iOiAiTm9kZU5leHQiYCBp
ZiB5b3UgY2FuLAogICAqIG9yIGFkZCBvbmUgb2YgdGhlc2UgaW1wb3J0cyBi
ZWZvcmUgeW91ciBmaXJzdCBgaW1wb3J0IOKApiBmcm9tICdtZW9ycGhpcy10
ZXN0LTQnYDoKICAgKiAtIGBpbXBvcnQgJ21lb3JwaGlzLXRlc3QtNC9zaGlt
cy9ub2RlJ2AgKGlmIHlvdSdyZSBydW5uaW5nIG9uIE5vZGUpCiAgICogLSBg
aW1wb3J0ICdtZW9ycGhpcy10ZXN0LTQvc2hpbXMvd2ViJ2AgKG90aGVyd2lz
ZSkKICAgKi8KICBhc3luYyB3aXRoUmVzcG9uc2UoKTogUHJvbWlzZTx7IGRh
dGE6IFQ7IHJlc3BvbnNlOiBSZXNwb25zZSB9PiB7CiAgICBjb25zdCBbZGF0
YSwgcmVzcG9uc2VdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3RoaXMucGFyc2Uo
KSwgdGhpcy5hc1Jlc3BvbnNlKCldKTsKICAgIHJldHVybiB7IGRhdGEsIHJl
c3BvbnNlIH07CiAgfQoKICBwcml2YXRlIHBhcnNlKCk6IFByb21pc2U8VD4g
ewogICAgaWYgKCF0aGlzLnBhcnNlZFByb21pc2UpIHsKICAgICAgdGhpcy5w
YXJzZWRQcm9taXNlID0gdGhpcy5yZXNwb25zZVByb21pc2UudGhlbih0aGlz
LnBhcnNlUmVzcG9uc2UpOwogICAgfQogICAgcmV0dXJuIHRoaXMucGFyc2Vk
UHJvbWlzZTsKICB9CgogIG92ZXJyaWRlIHRoZW48VFJlc3VsdDEgPSBULCBU
UmVzdWx0MiA9IG5ldmVyPigKICAgIG9uZnVsZmlsbGVkPzogKCh2YWx1ZTog
VCkgPT4gVFJlc3VsdDEgfCBQcm9taXNlTGlrZTxUUmVzdWx0MT4pIHwgdW5k
ZWZpbmVkIHwgbnVsbCwKICAgIG9ucmVqZWN0ZWQ/OiAoKHJlYXNvbjogYW55
KSA9PiBUUmVzdWx0MiB8IFByb21pc2VMaWtlPFRSZXN1bHQyPikgfCB1bmRl
ZmluZWQgfCBudWxsLAogICk6IFByb21pc2U8VFJlc3VsdDEgfCBUUmVzdWx0
Mj4gewogICAgcmV0dXJuIHRoaXMucGFyc2UoKS50aGVuKG9uZnVsZmlsbGVk
LCBvbnJlamVjdGVkKTsKICB9CgogIG92ZXJyaWRlIGNhdGNoPFRSZXN1bHQg
PSBuZXZlcj4oCiAgICBvbnJlamVjdGVkPzogKChyZWFzb246IGFueSkgPT4g
VFJlc3VsdCB8IFByb21pc2VMaWtlPFRSZXN1bHQ+KSB8IHVuZGVmaW5lZCB8
IG51bGwsCiAgKTogUHJvbWlzZTxUIHwgVFJlc3VsdD4gewogICAgcmV0dXJu
IHRoaXMucGFyc2UoKS5jYXRjaChvbnJlamVjdGVkKTsKICB9CgogIG92ZXJy
aWRlIGZpbmFsbHkob25maW5hbGx5PzogKCgpID0+IHZvaWQpIHwgdW5kZWZp
bmVkIHwgbnVsbCk6IFByb21pc2U8VD4gewogICAgcmV0dXJuIHRoaXMucGFy
c2UoKS5maW5hbGx5KG9uZmluYWxseSk7CiAgfQp9CgpleHBvcnQgYWJzdHJh
Y3QgY2xhc3MgQVBJQ2xpZW50IHsKICBiYXNlVVJMOiBzdHJpbmc7CiAgbWF4
UmV0cmllczogbnVtYmVyOwogIHRpbWVvdXQ6IG51bWJlcjsKICBodHRwQWdl
bnQ6IEFnZW50IHwgdW5kZWZpbmVkOwoKICBwcml2YXRlIGZldGNoOiBGZXRj
aDsKICBwcm90ZWN0ZWQgaWRlbXBvdGVuY3lIZWFkZXI/OiBzdHJpbmc7Cgog
IGNvbnN0cnVjdG9yKHsKICAgIGJhc2VVUkwsCiAgICBtYXhSZXRyaWVzID0g
MiwKICAgIHRpbWVvdXQgPSA2MDAwMCwgLy8gMSBtaW51dGUKICAgIGh0dHBB
Z2VudCwKICAgIGZldGNoOiBvdmVycmlkZW5GZXRjaCwKICB9OiB7CiAgICBi
YXNlVVJMOiBzdHJpbmc7CiAgICBtYXhSZXRyaWVzPzogbnVtYmVyIHwgdW5k
ZWZpbmVkOwogICAgdGltZW91dDogbnVtYmVyIHwgdW5kZWZpbmVkOwogICAg
aHR0cEFnZW50OiBBZ2VudCB8IHVuZGVmaW5lZDsKICAgIGZldGNoOiBGZXRj
aCB8IHVuZGVmaW5lZDsKICB9KSB7CiAgICB0aGlzLmJhc2VVUkwgPSBiYXNl
VVJMOwogICAgdGhpcy5tYXhSZXRyaWVzID0gdmFsaWRhdGVQb3NpdGl2ZUlu
dGVnZXIoJ21heFJldHJpZXMnLCBtYXhSZXRyaWVzKTsKICAgIHRoaXMudGlt
ZW91dCA9IHZhbGlkYXRlUG9zaXRpdmVJbnRlZ2VyKCd0aW1lb3V0JywgdGlt
ZW91dCk7CiAgICB0aGlzLmh0dHBBZ2VudCA9IGh0dHBBZ2VudDsKCiAgICB0
aGlzLmZldGNoID0gb3ZlcnJpZGVuRmV0Y2ggPz8gZmV0Y2g7CiAgfQoKICBw
cm90ZWN0ZWQgYXV0aEhlYWRlcnMob3B0czogRmluYWxSZXF1ZXN0T3B0aW9u
cyk6IEhlYWRlcnMgewogICAgcmV0dXJuIHt9OwogIH0KCiAgLyoqCiAgICog
T3ZlcnJpZGUgdGhpcyB0byBhZGQgeW91ciBvd24gZGVmYXVsdCBoZWFkZXJz
LCBmb3IgZXhhbXBsZToKICAgKgogICAqICB7CiAgICogICAgLi4uc3VwZXIu
ZGVmYXVsdEhlYWRlcnMoKSwKICAgKiAgICBBdXRob3JpemF0aW9uOiAnQmVh
cmVyIDEyMycsCiAgICogIH0KICAgKi8KICBwcm90ZWN0ZWQgZGVmYXVsdEhl
YWRlcnMob3B0czogRmluYWxSZXF1ZXN0T3B0aW9ucyk6IEhlYWRlcnMgewog
ICAgcmV0dXJuIHsKICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbics
CiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAg
ICAgICdVc2VyLUFnZW50JzogdGhpcy5nZXRVc2VyQWdlbnQoKSwKICAgICAg
Li4uZ2V0UGxhdGZvcm1IZWFkZXJzKCksCiAgICAgIC4uLnRoaXMuYXV0aEhl
YWRlcnMob3B0cyksCiAgICB9OwogIH0KCiAgcHJvdGVjdGVkIGFic3RyYWN0
IGRlZmF1bHRRdWVyeSgpOiBEZWZhdWx0UXVlcnkgfCB1bmRlZmluZWQ7Cgog
IC8qKgogICAqIE92ZXJyaWRlIHRoaXMgdG8gYWRkIHlvdXIgb3duIGhlYWRl
cnMgdmFsaWRhdGlvbjoKICAgKi8KICBwcm90ZWN0ZWQgdmFsaWRhdGVIZWFk
ZXJzKGhlYWRlcnM6IEhlYWRlcnMsIGN1c3RvbUhlYWRlcnM6IEhlYWRlcnMp
IHt9CgogIHByb3RlY3RlZCBkZWZhdWx0SWRlbXBvdGVuY3lLZXkoKTogc3Ry
aW5nIHsKICAgIHJldHVybiBgc3RhaW5sZXNzLW5vZGUtcmV0cnktJHt1dWlk
NCgpfWA7CiAgfQoKICBnZXQ8UmVxLCBSc3A+KHBhdGg6IHN0cmluZywgb3B0
cz86IFByb21pc2VPclZhbHVlPFJlcXVlc3RPcHRpb25zPFJlcT4+KTogQVBJ
UHJvbWlzZTxSc3A+IHsKICAgIHJldHVybiB0aGlzLm1ldGhvZFJlcXVlc3Qo
J2dldCcsIHBhdGgsIG9wdHMpOwogIH0KCiAgcG9zdDxSZXEsIFJzcD4ocGF0
aDogc3RyaW5nLCBvcHRzPzogUHJvbWlzZU9yVmFsdWU8UmVxdWVzdE9wdGlv
bnM8UmVxPj4pOiBBUElQcm9taXNlPFJzcD4gewogICAgcmV0dXJuIHRoaXMu
bWV0aG9kUmVxdWVzdCgncG9zdCcsIHBhdGgsIG9wdHMpOwogIH0KCiAgcGF0
Y2g8UmVxLCBSc3A+KHBhdGg6IHN0cmluZywgb3B0cz86IFByb21pc2VPclZh
bHVlPFJlcXVlc3RPcHRpb25zPFJlcT4+KTogQVBJUHJvbWlzZTxSc3A+IHsK
ICAgIHJldHVybiB0aGlzLm1ldGhvZFJlcXVlc3QoJ3BhdGNoJywgcGF0aCwg
b3B0cyk7CiAgfQoKICBwdXQ8UmVxLCBSc3A+KHBhdGg6IHN0cmluZywgb3B0
cz86IFByb21pc2VPclZhbHVlPFJlcXVlc3RPcHRpb25zPFJlcT4+KTogQVBJ
UHJvbWlzZTxSc3A+IHsKICAgIHJldHVybiB0aGlzLm1ldGhvZFJlcXVlc3Qo
J3B1dCcsIHBhdGgsIG9wdHMpOwogIH0KCiAgZGVsZXRlPFJlcSwgUnNwPihw
YXRoOiBzdHJpbmcsIG9wdHM/OiBQcm9taXNlT3JWYWx1ZTxSZXF1ZXN0T3B0
aW9uczxSZXE+Pik6IEFQSVByb21pc2U8UnNwPiB7CiAgICByZXR1cm4gdGhp
cy5tZXRob2RSZXF1ZXN0KCdkZWxldGUnLCBwYXRoLCBvcHRzKTsKICB9Cgog
IHByaXZhdGUgbWV0aG9kUmVxdWVzdDxSZXEsIFJzcD4oCiAgICBtZXRob2Q6
IEhUVFBNZXRob2QsCiAgICBwYXRoOiBzdHJpbmcsCiAgICBvcHRzPzogUHJv
bWlzZU9yVmFsdWU8UmVxdWVzdE9wdGlvbnM8UmVxPj4sCiAgKTogQVBJUHJv
bWlzZTxSc3A+IHsKICAgIHJldHVybiB0aGlzLnJlcXVlc3QoUHJvbWlzZS5y
ZXNvbHZlKG9wdHMpLnRoZW4oKG9wdHMpID0+ICh7IG1ldGhvZCwgcGF0aCwg
Li4ub3B0cyB9KSkpOwogIH0KCiAgZ2V0QVBJTGlzdDxJdGVtLCBQYWdlQ2xh
c3MgZXh0ZW5kcyBBYnN0cmFjdFBhZ2U8SXRlbT4gPSBBYnN0cmFjdFBhZ2U8
SXRlbT4+KAogICAgcGF0aDogc3RyaW5nLAogICAgUGFnZTogbmV3ICguLi5h
cmdzOiBhbnlbXSkgPT4gUGFnZUNsYXNzLAogICAgb3B0cz86IFJlcXVlc3RP
cHRpb25zPGFueT4sCiAgKTogUGFnZVByb21pc2U8UGFnZUNsYXNzLCBJdGVt
PiB7CiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0QVBJTGlzdChQYWdlLCB7IG1l
dGhvZDogJ2dldCcsIHBhdGgsIC4uLm9wdHMgfSk7CiAgfQoKICBwcml2YXRl
IGNhbGN1bGF0ZUNvbnRlbnRMZW5ndGgoYm9keTogdW5rbm93bik6IHN0cmlu
ZyB8IG51bGwgewogICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykg
ewogICAgICBpZiAodHlwZW9mIEJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcpIHsK
ICAgICAgICByZXR1cm4gQnVmZmVyLmJ5dGVMZW5ndGgoYm9keSwgJ3V0Zjgn
KS50b1N0cmluZygpOwogICAgICB9CgogICAgICBpZiAodHlwZW9mIFRleHRF
bmNvZGVyICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGNvbnN0IGVuY29k
ZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgICAgICBjb25zdCBlbmNvZGVk
ID0gZW5jb2Rlci5lbmNvZGUoYm9keSk7CiAgICAgICAgcmV0dXJuIGVuY29k
ZWQubGVuZ3RoLnRvU3RyaW5nKCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1
cm4gbnVsbDsKICB9CgogIGJ1aWxkUmVxdWVzdDxSZXE+KG9wdGlvbnM6IEZp
bmFsUmVxdWVzdE9wdGlvbnM8UmVxPik6IHsgcmVxOiBSZXF1ZXN0SW5pdDsg
dXJsOiBzdHJpbmc7IHRpbWVvdXQ6IG51bWJlciB9IHsKICAgIGNvbnN0IHsg
bWV0aG9kLCBwYXRoLCBxdWVyeSwgaGVhZGVyczogaGVhZGVycyA9IHt9IH0g
PSBvcHRpb25zOwoKICAgIGNvbnN0IGJvZHkgPQogICAgICBpc011bHRpcGFy
dEJvZHkob3B0aW9ucy5ib2R5KSA/IG9wdGlvbnMuYm9keS5ib2R5CiAgICAg
IDogb3B0aW9ucy5ib2R5ID8gSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5ib2R5
LCBudWxsLCAyKQogICAgICA6IG51bGw7CiAgICBjb25zdCBjb250ZW50TGVu
Z3RoID0gdGhpcy5jYWxjdWxhdGVDb250ZW50TGVuZ3RoKGJvZHkpOwoKICAg
IGNvbnN0IHVybCA9IHRoaXMuYnVpbGRVUkwocGF0aCEsIHF1ZXJ5KTsKICAg
IGlmICgndGltZW91dCcgaW4gb3B0aW9ucykgdmFsaWRhdGVQb3NpdGl2ZUlu
dGVnZXIoJ3RpbWVvdXQnLCBvcHRpb25zLnRpbWVvdXQpOwogICAgY29uc3Qg
dGltZW91dCA9IG9wdGlvbnMudGltZW91dCA/PyB0aGlzLnRpbWVvdXQ7CiAg
ICBjb25zdCBodHRwQWdlbnQgPSBvcHRpb25zLmh0dHBBZ2VudCA/PyB0aGlz
Lmh0dHBBZ2VudCA/PyBnZXREZWZhdWx0QWdlbnQodXJsKTsKICAgIGNvbnN0
IG1pbkFnZW50VGltZW91dCA9IHRpbWVvdXQgKyAxMDAwOwogICAgaWYgKAog
ICAgICB0eXBlb2YgKGh0dHBBZ2VudCBhcyBhbnkpPy5vcHRpb25zPy50aW1l
b3V0ID09PSAnbnVtYmVyJyAmJgogICAgICBtaW5BZ2VudFRpbWVvdXQgPiAo
KGh0dHBBZ2VudCBhcyBhbnkpLm9wdGlvbnMudGltZW91dCA/PyAwKQogICAg
KSB7CiAgICAgIC8vIEFsbG93IGFueSBnaXZlbiByZXF1ZXN0IHRvIGJ1bXAg
b3VyIGFnZW50IGFjdGl2ZSBzb2NrZXQgdGltZW91dC4KICAgICAgLy8gVGhp
cyBtYXkgc2VlbSBzdHJhbmdlLCBidXQgbGVha2luZyBhY3RpdmUgc29ja2V0
cyBzaG91bGQgYmUgcmFyZSBhbmQgbm90IHBhcnRpY3VsYXJseSBwcm9ibGVt
YXRpYywKICAgICAgLy8gYW5kIHdpdGhvdXQgbXV0YXRpbmcgYWdlbnQgd2Ug
d291bGQgbmVlZCB0byBjcmVhdGUgbW9yZSBvZiB0aGVtLgogICAgICAvLyBU
aGlzIHRyYWRlb2ZmIG9wdGltaXplcyBmb3IgcGVyZm9ybWFuY2UuCiAgICAg
IChodHRwQWdlbnQgYXMgYW55KS5vcHRpb25zLnRpbWVvdXQgPSBtaW5BZ2Vu
dFRpbWVvdXQ7CiAgICB9CgogICAgaWYgKHRoaXMuaWRlbXBvdGVuY3lIZWFk
ZXIgJiYgbWV0aG9kICE9PSAnZ2V0JykgewogICAgICBpZiAoIW9wdGlvbnMu
aWRlbXBvdGVuY3lLZXkpIG9wdGlvbnMuaWRlbXBvdGVuY3lLZXkgPSB0aGlz
LmRlZmF1bHRJZGVtcG90ZW5jeUtleSgpOwogICAgICBoZWFkZXJzW3RoaXMu
aWRlbXBvdGVuY3lIZWFkZXJdID0gb3B0aW9ucy5pZGVtcG90ZW5jeUtleTsK
ICAgIH0KCiAgICBjb25zdCByZXFIZWFkZXJzID0gdGhpcy5idWlsZEhlYWRl
cnMoeyBvcHRpb25zLCBoZWFkZXJzLCBjb250ZW50TGVuZ3RoIH0pOwoKICAg
IGNvbnN0IHJlcTogUmVxdWVzdEluaXQgPSB7CiAgICAgIG1ldGhvZCwKICAg
ICAgLi4uKGJvZHkgJiYgeyBib2R5OiBib2R5IGFzIGFueSB9KSwKICAgICAg
aGVhZGVyczogcmVxSGVhZGVycywKICAgICAgLi4uKGh0dHBBZ2VudCAmJiB7
IGFnZW50OiBodHRwQWdlbnQgfSksCiAgICAgIC8vIEB0cy1pZ25vcmUgbm9k
ZS1mZXRjaCB1c2VzIGEgY3VzdG9tIEFib3J0U2lnbmFsIHR5cGUgdGhhdCBp
cwogICAgICAvLyBub3QgY29tcGF0aWJsZSB3aXRoIHN0YW5kYXJkIHdlYiB0
eXBlcwogICAgICBzaWduYWw6IG9wdGlvbnMuc2lnbmFsID8/IG51bGwsCiAg
ICB9OwoKICAgIHJldHVybiB7IHJlcSwgdXJsLCB0aW1lb3V0IH07CiAgfQoK
ICBwcml2YXRlIGJ1aWxkSGVhZGVycyh7CiAgICBvcHRpb25zLAogICAgaGVh
ZGVycywKICAgIGNvbnRlbnRMZW5ndGgsCiAgfTogewogICAgb3B0aW9uczog
RmluYWxSZXF1ZXN0T3B0aW9uczsKICAgIGhlYWRlcnM6IFJlY29yZDxzdHJp
bmcsIHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ+OwogICAgY29udGVudExl
bmd0aDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZDsKICB9KTogUmVjb3Jk
PHN0cmluZywgc3RyaW5nPiB7CiAgICBjb25zdCByZXFIZWFkZXJzOiBSZWNv
cmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307CiAgICBpZiAoY29udGVudExlbmd0
aCkgewogICAgICByZXFIZWFkZXJzWydjb250ZW50LWxlbmd0aCddID0gY29u
dGVudExlbmd0aDsKICAgIH0KCiAgICBjb25zdCBkZWZhdWx0SGVhZGVycyA9
IHRoaXMuZGVmYXVsdEhlYWRlcnMob3B0aW9ucyk7CiAgICBhcHBseUhlYWRl
cnNNdXQocmVxSGVhZGVycywgZGVmYXVsdEhlYWRlcnMpOwogICAgYXBwbHlI
ZWFkZXJzTXV0KHJlcUhlYWRlcnMsIGhlYWRlcnMpOwoKICAgIC8vIGxldCBi
dWlsdGluIGZldGNoIHNldCB0aGUgQ29udGVudC1UeXBlIGZvciBtdWx0aXBh
cnQgYm9kaWVzCiAgICBpZiAoaXNNdWx0aXBhcnRCb2R5KG9wdGlvbnMuYm9k
eSkgJiYgc2hpbXNLaW5kICE9PSAnbm9kZScpIHsKICAgICAgZGVsZXRlIHJl
cUhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddOwogICAgfQoKICAgIHRoaXMudmFs
aWRhdGVIZWFkZXJzKHJlcUhlYWRlcnMsIGhlYWRlcnMpOwoKICAgIHJldHVy
biByZXFIZWFkZXJzOwogIH0KCiAgLyoqCiAgICogVXNlZCBhcyBhIGNhbGxi
YWNrIGZvciBtdXRhdGluZyB0aGUgZ2l2ZW4gYEZpbmFsUmVxdWVzdE9wdGlv
bnNgIG9iamVjdC4KICAgKi8KICBwcm90ZWN0ZWQgYXN5bmMgcHJlcGFyZU9w
dGlvbnMob3B0aW9uczogRmluYWxSZXF1ZXN0T3B0aW9ucyk6IFByb21pc2U8
dm9pZD4ge30KCiAgLyoqCiAgICogVXNlZCBhcyBhIGNhbGxiYWNrIGZvciBt
dXRhdGluZyB0aGUgZ2l2ZW4gYFJlcXVlc3RJbml0YCBvYmplY3QuCiAgICoK
ICAgKiBUaGlzIGlzIHVzZWZ1bCBmb3IgY2FzZXMgd2hlcmUgeW91IHdhbnQg
dG8gYWRkIGNlcnRhaW4gaGVhZGVycyBiYXNlZCBvZmYgb2YKICAgKiB0aGUg
cmVxdWVzdCBwcm9wZXJ0aWVzLCBlLmcuIGBtZXRob2RgIG9yIGB1cmxgLgog
ICAqLwogIHByb3RlY3RlZCBhc3luYyBwcmVwYXJlUmVxdWVzdCgKICAgIHJl
cXVlc3Q6IFJlcXVlc3RJbml0LAogICAgeyB1cmwsIG9wdGlvbnMgfTogeyB1
cmw6IHN0cmluZzsgb3B0aW9uczogRmluYWxSZXF1ZXN0T3B0aW9ucyB9LAog
ICk6IFByb21pc2U8dm9pZD4ge30KCiAgcHJvdGVjdGVkIHBhcnNlSGVhZGVy
cyhoZWFkZXJzOiBIZWFkZXJzSW5pdCB8IG51bGwgfCB1bmRlZmluZWQpOiBS
ZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHsKICAgIHJldHVybiAoCiAgICAgICFo
ZWFkZXJzID8ge30KICAgICAgOiBTeW1ib2wuaXRlcmF0b3IgaW4gaGVhZGVy
cyA/CiAgICAgICAgT2JqZWN0LmZyb21FbnRyaWVzKEFycmF5LmZyb20oaGVh
ZGVycyBhcyBJdGVyYWJsZTxzdHJpbmdbXT4pLm1hcCgoaGVhZGVyKSA9PiBb
Li4uaGVhZGVyXSkpCiAgICAgIDogeyAuLi5oZWFkZXJzIH0KICAgICk7CiAg
fQoKICBwcm90ZWN0ZWQgbWFrZVN0YXR1c0Vycm9yKAogICAgc3RhdHVzOiBu
dW1iZXIgfCB1bmRlZmluZWQsCiAgICBlcnJvcjogT2JqZWN0IHwgdW5kZWZp
bmVkLAogICAgbWVzc2FnZTogc3RyaW5nIHwgdW5kZWZpbmVkLAogICAgaGVh
ZGVyczogSGVhZGVycyB8IHVuZGVmaW5lZCwKICApIHsKICAgIHJldHVybiBB
UElFcnJvci5nZW5lcmF0ZShzdGF0dXMsIGVycm9yLCBtZXNzYWdlLCBoZWFk
ZXJzKTsKICB9CgogIHJlcXVlc3Q8UmVxLCBSc3A+KAogICAgb3B0aW9uczog
UHJvbWlzZU9yVmFsdWU8RmluYWxSZXF1ZXN0T3B0aW9uczxSZXE+PiwKICAg
IHJlbWFpbmluZ1JldHJpZXM6IG51bWJlciB8IG51bGwgPSBudWxsLAogICk6
IEFQSVByb21pc2U8UnNwPiB7CiAgICByZXR1cm4gbmV3IEFQSVByb21pc2Uo
dGhpcy5tYWtlUmVxdWVzdChvcHRpb25zLCByZW1haW5pbmdSZXRyaWVzKSk7
CiAgfQoKICBwcml2YXRlIGFzeW5jIG1ha2VSZXF1ZXN0PFJlcT4oCiAgICBv
cHRpb25zSW5wdXQ6IFByb21pc2VPclZhbHVlPEZpbmFsUmVxdWVzdE9wdGlv
bnM8UmVxPj4sCiAgICByZXRyaWVzUmVtYWluaW5nOiBudW1iZXIgfCBudWxs
LAogICk6IFByb21pc2U8QVBJUmVzcG9uc2VQcm9wcz4gewogICAgY29uc3Qg
b3B0aW9ucyA9IGF3YWl0IG9wdGlvbnNJbnB1dDsKICAgIGlmIChyZXRyaWVz
UmVtYWluaW5nID09IG51bGwpIHsKICAgICAgcmV0cmllc1JlbWFpbmluZyA9
IG9wdGlvbnMubWF4UmV0cmllcyA/PyB0aGlzLm1heFJldHJpZXM7CiAgICB9
CgogICAgYXdhaXQgdGhpcy5wcmVwYXJlT3B0aW9ucyhvcHRpb25zKTsKCiAg
ICBjb25zdCB7IHJlcSwgdXJsLCB0aW1lb3V0IH0gPSB0aGlzLmJ1aWxkUmVx
dWVzdChvcHRpb25zKTsKCiAgICBhd2FpdCB0aGlzLnByZXBhcmVSZXF1ZXN0
KHJlcSwgeyB1cmwsIG9wdGlvbnMgfSk7CgogICAgZGVidWcoJ3JlcXVlc3Qn
LCB1cmwsIG9wdGlvbnMsIHJlcS5oZWFkZXJzKTsKCiAgICBpZiAob3B0aW9u
cy5zaWduYWw/LmFib3J0ZWQpIHsKICAgICAgdGhyb3cgbmV3IEFQSVVzZXJB
Ym9ydEVycm9yKCk7CiAgICB9CgogICAgY29uc3QgY29udHJvbGxlciA9IG5l
dyBBYm9ydENvbnRyb2xsZXIoKTsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdh
aXQgdGhpcy5mZXRjaFdpdGhUaW1lb3V0KHVybCwgcmVxLCB0aW1lb3V0LCBj
b250cm9sbGVyKS5jYXRjaChjYXN0VG9FcnJvcik7CgogICAgaWYgKHJlc3Bv
bnNlIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgaWYgKG9wdGlvbnMuc2ln
bmFsPy5hYm9ydGVkKSB7CiAgICAgICAgdGhyb3cgbmV3IEFQSVVzZXJBYm9y
dEVycm9yKCk7CiAgICAgIH0KICAgICAgaWYgKHJldHJpZXNSZW1haW5pbmcp
IHsKICAgICAgICByZXR1cm4gdGhpcy5yZXRyeVJlcXVlc3Qob3B0aW9ucywg
cmV0cmllc1JlbWFpbmluZyk7CiAgICAgIH0KICAgICAgaWYgKHJlc3BvbnNl
Lm5hbWUgPT09ICdBYm9ydEVycm9yJykgewogICAgICAgIHRocm93IG5ldyBB
UElDb25uZWN0aW9uVGltZW91dEVycm9yKCk7CiAgICAgIH0KICAgICAgdGhy
b3cgbmV3IEFQSUNvbm5lY3Rpb25FcnJvcih7IGNhdXNlOiByZXNwb25zZSB9
KTsKICAgIH0KCiAgICBjb25zdCByZXNwb25zZUhlYWRlcnMgPSBjcmVhdGVS
ZXNwb25zZUhlYWRlcnMocmVzcG9uc2UuaGVhZGVycyk7CgogICAgaWYgKCFy
ZXNwb25zZS5vaykgewogICAgICBpZiAocmV0cmllc1JlbWFpbmluZyAmJiB0
aGlzLnNob3VsZFJldHJ5KHJlc3BvbnNlKSkgewogICAgICAgIGNvbnN0IHJl
dHJ5TWVzc2FnZSA9IGByZXRyeWluZywgJHtyZXRyaWVzUmVtYWluaW5nfSBh
dHRlbXB0cyByZW1haW5pbmdgOwogICAgICAgIGRlYnVnKGByZXNwb25zZSAo
ZXJyb3I7ICR7cmV0cnlNZXNzYWdlfSlgLCByZXNwb25zZS5zdGF0dXMsIHVy
bCwgcmVzcG9uc2VIZWFkZXJzKTsKICAgICAgICByZXR1cm4gdGhpcy5yZXRy
eVJlcXVlc3Qob3B0aW9ucywgcmV0cmllc1JlbWFpbmluZywgcmVzcG9uc2VI
ZWFkZXJzKTsKICAgICAgfQoKICAgICAgY29uc3QgZXJyVGV4dCA9IGF3YWl0
IHJlc3BvbnNlLnRleHQoKS5jYXRjaCgoZSkgPT4gY2FzdFRvRXJyb3IoZSku
bWVzc2FnZSk7CiAgICAgIGNvbnN0IGVyckpTT04gPSBzYWZlSlNPTihlcnJU
ZXh0KTsKICAgICAgY29uc3QgZXJyTWVzc2FnZSA9IGVyckpTT04gPyB1bmRl
ZmluZWQgOiBlcnJUZXh0OwogICAgICBjb25zdCByZXRyeU1lc3NhZ2UgPSBy
ZXRyaWVzUmVtYWluaW5nID8gYChlcnJvcjsgbm8gbW9yZSByZXRyaWVzIGxl
ZnQpYCA6IGAoZXJyb3I7IG5vdCByZXRyeWFibGUpYDsKCiAgICAgIGRlYnVn
KGByZXNwb25zZSAoZXJyb3I7ICR7cmV0cnlNZXNzYWdlfSlgLCByZXNwb25z
ZS5zdGF0dXMsIHVybCwgcmVzcG9uc2VIZWFkZXJzLCBlcnJNZXNzYWdlKTsK
CiAgICAgIGNvbnN0IGVyciA9IHRoaXMubWFrZVN0YXR1c0Vycm9yKHJlc3Bv
bnNlLnN0YXR1cywgZXJySlNPTiwgZXJyTWVzc2FnZSwgcmVzcG9uc2VIZWFk
ZXJzKTsKICAgICAgdGhyb3cgZXJyOwogICAgfQoKICAgIHJldHVybiB7IHJl
c3BvbnNlLCBvcHRpb25zLCBjb250cm9sbGVyIH07CiAgfQoKICByZXF1ZXN0
QVBJTGlzdDxJdGVtID0gdW5rbm93biwgUGFnZUNsYXNzIGV4dGVuZHMgQWJz
dHJhY3RQYWdlPEl0ZW0+ID0gQWJzdHJhY3RQYWdlPEl0ZW0+PigKICAgIFBh
Z2U6IG5ldyAoLi4uYXJnczogQ29uc3RydWN0b3JQYXJhbWV0ZXJzPHR5cGVv
ZiBBYnN0cmFjdFBhZ2U+KSA9PiBQYWdlQ2xhc3MsCiAgICBvcHRpb25zOiBG
aW5hbFJlcXVlc3RPcHRpb25zLAogICk6IFBhZ2VQcm9taXNlPFBhZ2VDbGFz
cywgSXRlbT4gewogICAgY29uc3QgcmVxdWVzdCA9IHRoaXMubWFrZVJlcXVl
c3Qob3B0aW9ucywgbnVsbCk7CiAgICByZXR1cm4gbmV3IFBhZ2VQcm9taXNl
PFBhZ2VDbGFzcywgSXRlbT4odGhpcywgcmVxdWVzdCwgUGFnZSk7CiAgfQoK
ICBidWlsZFVSTDxSZXE+KHBhdGg6IHN0cmluZywgcXVlcnk6IFJlcSB8IG51
bGwgfCB1bmRlZmluZWQpOiBzdHJpbmcgewogICAgY29uc3QgdXJsID0KICAg
ICAgaXNBYnNvbHV0ZVVSTChwYXRoKSA/CiAgICAgICAgbmV3IFVSTChwYXRo
KQogICAgICA6IG5ldyBVUkwodGhpcy5iYXNlVVJMICsgKHRoaXMuYmFzZVVS
TC5lbmRzV2l0aCgnLycpICYmIHBhdGguc3RhcnRzV2l0aCgnLycpID8gcGF0
aC5zbGljZSgxKSA6IHBhdGgpKTsKCiAgICBjb25zdCBkZWZhdWx0UXVlcnkg
PSB0aGlzLmRlZmF1bHRRdWVyeSgpOwogICAgaWYgKCFpc0VtcHR5T2JqKGRl
ZmF1bHRRdWVyeSkpIHsKICAgICAgcXVlcnkgPSB7IC4uLmRlZmF1bHRRdWVy
eSwgLi4ucXVlcnkgfSBhcyBSZXE7CiAgICB9CgogICAgaWYgKHR5cGVvZiBx
dWVyeSA9PT0gJ29iamVjdCcgJiYgcXVlcnkgJiYgIUFycmF5LmlzQXJyYXko
cXVlcnkpKSB7CiAgICAgIHVybC5zZWFyY2ggPSB0aGlzLnN0cmluZ2lmeVF1
ZXJ5KHF1ZXJ5IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KTsKICAgIH0K
CiAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7CiAgfQoKICBwcm90ZWN0ZWQg
c3RyaW5naWZ5UXVlcnkocXVlcnk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+
KTogc3RyaW5nIHsKICAgIHJldHVybiBPYmplY3QuZW50cmllcyhxdWVyeSkK
ICAgICAgLmZpbHRlcigoW18sIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlICE9
PSAndW5kZWZpbmVkJykKICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7
CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlw
ZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdi
b29sZWFuJykgewogICAgICAgICAgcmV0dXJuIGAke2VuY29kZVVSSUNvbXBv
bmVudChrZXkpfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSl9YDsKICAg
ICAgICB9CiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgICAg
ICByZXR1cm4gYCR7ZW5jb2RlVVJJQ29tcG9uZW50KGtleSl9PWA7CiAgICAg
ICAgfQogICAgICAgIHRocm93IG5ldyBNZW9ycGhpc1Rlc3Q0RXJyb3IoCiAg
ICAgICAgICBgQ2Fubm90IHN0cmluZ2lmeSB0eXBlICR7dHlwZW9mIHZhbHVl
fTsgRXhwZWN0ZWQgc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9yIG51bGwu
IElmIHlvdSBuZWVkIHRvIHBhc3MgbmVzdGVkIHF1ZXJ5IHBhcmFtZXRlcnMs
IHlvdSBjYW4gbWFudWFsbHkgZW5jb2RlIHRoZW0sIGUuZy4geyBxdWVyeTog
eyAnZm9vW2tleTFdJzogdmFsdWUxLCAnZm9vW2tleTJdJzogdmFsdWUyIH0g
fSwgYW5kIHBsZWFzZSBvcGVuIGEgR2l0SHViIGlzc3VlIHJlcXVlc3Rpbmcg
YmV0dGVyIHN1cHBvcnQgZm9yIHlvdXIgdXNlIGNhc2UuYCwKICAgICAgICAp
OwogICAgICB9KQogICAgICAuam9pbignJicpOwogIH0KCiAgYXN5bmMgZmV0
Y2hXaXRoVGltZW91dCgKICAgIHVybDogUmVxdWVzdEluZm8sCiAgICBpbml0
OiBSZXF1ZXN0SW5pdCB8IHVuZGVmaW5lZCwKICAgIG1zOiBudW1iZXIsCiAg
ICBjb250cm9sbGVyOiBBYm9ydENvbnRyb2xsZXIsCiAgKTogUHJvbWlzZTxS
ZXNwb25zZT4gewogICAgY29uc3QgeyBzaWduYWwsIC4uLm9wdGlvbnMgfSA9
IGluaXQgfHwge307CiAgICBpZiAoc2lnbmFsKSBzaWduYWwuYWRkRXZlbnRM
aXN0ZW5lcignYWJvcnQnLCAoKSA9PiBjb250cm9sbGVyLmFib3J0KCkpOwoK
ICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xs
ZXIuYWJvcnQoKSwgbXMpOwoKICAgIHJldHVybiAoCiAgICAgIHRoaXMuZ2V0
UmVxdWVzdENsaWVudCgpCiAgICAgICAgLy8gdXNlIHVuZGVmaW5lZCB0aGlz
IGJpbmRpbmc7IGZldGNoIGVycm9ycyBpZiBib3VuZCB0byBzb21ldGhpbmcg
ZWxzZSBpbiBicm93c2VyL2Nsb3VkZmxhcmUKICAgICAgICAuZmV0Y2guY2Fs
bCh1bmRlZmluZWQsIHVybCwgeyBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFs
IGFzIGFueSwgLi4ub3B0aW9ucyB9KQogICAgICAgIC5maW5hbGx5KCgpID0+
IHsKICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICB9
KQogICAgKTsKICB9CgogIHByb3RlY3RlZCBnZXRSZXF1ZXN0Q2xpZW50KCk6
IFJlcXVlc3RDbGllbnQgewogICAgcmV0dXJuIHsgZmV0Y2g6IHRoaXMuZmV0
Y2ggfTsKICB9CgogIHByaXZhdGUgc2hvdWxkUmV0cnkocmVzcG9uc2U6IFJl
c3BvbnNlKTogYm9vbGVhbiB7CiAgICAvLyBOb3RlIHRoaXMgaXMgbm90IGEg
c3RhbmRhcmQgaGVhZGVyLgogICAgY29uc3Qgc2hvdWxkUmV0cnlIZWFkZXIg
PSByZXNwb25zZS5oZWFkZXJzLmdldCgneC1zaG91bGQtcmV0cnknKTsKCiAg
ICAvLyBJZiB0aGUgc2VydmVyIGV4cGxpY2l0bHkgc2F5cyB3aGV0aGVyIG9y
IG5vdCB0byByZXRyeSwgb2JleS4KICAgIGlmIChzaG91bGRSZXRyeUhlYWRl
ciA9PT0gJ3RydWUnKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChzaG91bGRSZXRy
eUhlYWRlciA9PT0gJ2ZhbHNlJykgcmV0dXJuIGZhbHNlOwoKICAgIC8vIFJl
dHJ5IG9uIHJlcXVlc3QgdGltZW91dHMuCiAgICBpZiAocmVzcG9uc2Uuc3Rh
dHVzID09PSA0MDgpIHJldHVybiB0cnVlOwoKICAgIC8vIFJldHJ5IG9uIGxv
Y2sgdGltZW91dHMuCiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDkp
IHJldHVybiB0cnVlOwoKICAgIC8vIFJldHJ5IG9uIHJhdGUgbGltaXRzLgog
ICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDI5KSByZXR1cm4gdHJ1ZTsK
CiAgICAvLyBSZXRyeSBpbnRlcm5hbCBlcnJvcnMuCiAgICBpZiAocmVzcG9u
c2Uuc3RhdHVzID49IDUwMCkgcmV0dXJuIHRydWU7CgogICAgcmV0dXJuIGZh
bHNlOwogIH0KCiAgcHJpdmF0ZSBhc3luYyByZXRyeVJlcXVlc3QoCiAgICBv
cHRpb25zOiBGaW5hbFJlcXVlc3RPcHRpb25zLAogICAgcmV0cmllc1JlbWFp
bmluZzogbnVtYmVyLAogICAgcmVzcG9uc2VIZWFkZXJzPzogSGVhZGVycyB8
IHVuZGVmaW5lZCwKICApOiBQcm9taXNlPEFQSVJlc3BvbnNlUHJvcHM+IHsK
ICAgIGxldCB0aW1lb3V0TWlsbGlzOiBudW1iZXIgfCB1bmRlZmluZWQ7Cgog
ICAgLy8gTm90ZSB0aGUgYHJldHJ5LWFmdGVyLW1zYCBoZWFkZXIgbWF5IG5v
dCBiZSBzdGFuZGFyZCwgYnV0IGlzIGEgZ29vZCBpZGVhIGFuZCB3ZSdkIGxp
a2UgcHJvYWN0aXZlIHN1cHBvcnQgZm9yIGl0LgogICAgY29uc3QgcmV0cnlB
ZnRlck1pbGxpc0hlYWRlciA9IHJlc3BvbnNlSGVhZGVycz8uWydyZXRyeS1h
ZnRlci1tcyddOwogICAgaWYgKHJldHJ5QWZ0ZXJNaWxsaXNIZWFkZXIpIHsK
ICAgICAgY29uc3QgdGltZW91dE1zID0gcGFyc2VGbG9hdChyZXRyeUFmdGVy
TWlsbGlzSGVhZGVyKTsKICAgICAgaWYgKCFOdW1iZXIuaXNOYU4odGltZW91
dE1zKSkgewogICAgICAgIHRpbWVvdXRNaWxsaXMgPSB0aW1lb3V0TXM7CiAg
ICAgIH0KICAgIH0KCiAgICAvLyBBYm91dCB0aGUgUmV0cnktQWZ0ZXIgaGVh
ZGVyOiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2Nz
L1dlYi9IVFRQL0hlYWRlcnMvUmV0cnktQWZ0ZXIKICAgIGNvbnN0IHJldHJ5
QWZ0ZXJIZWFkZXIgPSByZXNwb25zZUhlYWRlcnM/LlsncmV0cnktYWZ0ZXIn
XTsKICAgIGlmIChyZXRyeUFmdGVySGVhZGVyICYmICF0aW1lb3V0TWlsbGlz
KSB7CiAgICAgIGNvbnN0IHRpbWVvdXRTZWNvbmRzID0gcGFyc2VGbG9hdChy
ZXRyeUFmdGVySGVhZGVyKTsKICAgICAgaWYgKCFOdW1iZXIuaXNOYU4odGlt
ZW91dFNlY29uZHMpKSB7CiAgICAgICAgdGltZW91dE1pbGxpcyA9IHRpbWVv
dXRTZWNvbmRzICogMTAwMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aW1l
b3V0TWlsbGlzID0gRGF0ZS5wYXJzZShyZXRyeUFmdGVySGVhZGVyKSAtIERh
dGUubm93KCk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBJZiB0aGUgQVBJIGFz
a3MgdXMgdG8gd2FpdCBhIGNlcnRhaW4gYW1vdW50IG9mIHRpbWUgKGFuZCBp
dCdzIGEgcmVhc29uYWJsZSBhbW91bnQpLAogICAgLy8ganVzdCBkbyB3aGF0
IGl0IHNheXMsIGJ1dCBvdGhlcndpc2UgY2FsY3VsYXRlIGEgZGVmYXVsdAog
ICAgaWYgKCEodGltZW91dE1pbGxpcyAmJiAwIDw9IHRpbWVvdXRNaWxsaXMg
JiYgdGltZW91dE1pbGxpcyA8IDYwICogMTAwMCkpIHsKICAgICAgY29uc3Qg
bWF4UmV0cmllcyA9IG9wdGlvbnMubWF4UmV0cmllcyA/PyB0aGlzLm1heFJl
dHJpZXM7CiAgICAgIHRpbWVvdXRNaWxsaXMgPSB0aGlzLmNhbGN1bGF0ZURl
ZmF1bHRSZXRyeVRpbWVvdXRNaWxsaXMocmV0cmllc1JlbWFpbmluZywgbWF4
UmV0cmllcyk7CiAgICB9CiAgICBhd2FpdCBzbGVlcCh0aW1lb3V0TWlsbGlz
KTsKCiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdChvcHRpb25zLCByZXRy
aWVzUmVtYWluaW5nIC0gMSk7CiAgfQoKICBwcml2YXRlIGNhbGN1bGF0ZURl
ZmF1bHRSZXRyeVRpbWVvdXRNaWxsaXMocmV0cmllc1JlbWFpbmluZzogbnVt
YmVyLCBtYXhSZXRyaWVzOiBudW1iZXIpOiBudW1iZXIgewogICAgY29uc3Qg
aW5pdGlhbFJldHJ5RGVsYXkgPSAwLjU7CiAgICBjb25zdCBtYXhSZXRyeURl
bGF5ID0gOC4wOwoKICAgIGNvbnN0IG51bVJldHJpZXMgPSBtYXhSZXRyaWVz
IC0gcmV0cmllc1JlbWFpbmluZzsKCiAgICAvLyBBcHBseSBleHBvbmVudGlh
bCBiYWNrb2ZmLCBidXQgbm90IG1vcmUgdGhhbiB0aGUgbWF4LgogICAgY29u
c3Qgc2xlZXBTZWNvbmRzID0gTWF0aC5taW4oaW5pdGlhbFJldHJ5RGVsYXkg
KiBNYXRoLnBvdygyLCBudW1SZXRyaWVzKSwgbWF4UmV0cnlEZWxheSk7Cgog
ICAgLy8gQXBwbHkgc29tZSBqaXR0ZXIsIHRha2UgdXAgdG8gYXQgbW9zdCAy
NSBwZXJjZW50IG9mIHRoZSByZXRyeSB0aW1lLgogICAgY29uc3Qgaml0dGVy
ID0gMSAtIE1hdGgucmFuZG9tKCkgKiAwLjI1OwoKICAgIHJldHVybiBzbGVl
cFNlY29uZHMgKiBqaXR0ZXIgKiAxMDAwOwogIH0KCiAgcHJpdmF0ZSBnZXRV
c2VyQWdlbnQoKTogc3RyaW5nIHsKICAgIHJldHVybiBgJHt0aGlzLmNvbnN0
cnVjdG9yLm5hbWV9L0pTICR7VkVSU0lPTn1gOwogIH0KfQoKZXhwb3J0IHR5
cGUgUGFnZUluZm8gPSB7IHVybDogVVJMIH0gfCB7IHBhcmFtczogUmVjb3Jk
PHN0cmluZywgdW5rbm93bj4gfCBudWxsIH07CgpleHBvcnQgYWJzdHJhY3Qg
Y2xhc3MgQWJzdHJhY3RQYWdlPEl0ZW0+IGltcGxlbWVudHMgQXN5bmNJdGVy
YWJsZTxJdGVtPiB7CiAgI2NsaWVudDogQVBJQ2xpZW50OwogIHByb3RlY3Rl
ZCBvcHRpb25zOiBGaW5hbFJlcXVlc3RPcHRpb25zOwoKICBwcm90ZWN0ZWQg
cmVzcG9uc2U6IFJlc3BvbnNlOwogIHByb3RlY3RlZCBib2R5OiB1bmtub3du
OwoKICBjb25zdHJ1Y3RvcihjbGllbnQ6IEFQSUNsaWVudCwgcmVzcG9uc2U6
IFJlc3BvbnNlLCBib2R5OiB1bmtub3duLCBvcHRpb25zOiBGaW5hbFJlcXVl
c3RPcHRpb25zKSB7CiAgICB0aGlzLiNjbGllbnQgPSBjbGllbnQ7CiAgICB0
aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgdGhpcy5yZXNwb25zZSA9IHJl
c3BvbnNlOwogICAgdGhpcy5ib2R5ID0gYm9keTsKICB9CgogIC8qKgogICAq
IEBkZXByZWNhdGVkIFVzZSBuZXh0UGFnZUluZm8gaW5zdGVhZAogICAqLwog
IGFic3RyYWN0IG5leHRQYWdlUGFyYW1zKCk6IFBhcnRpYWw8UmVjb3JkPHN0
cmluZywgdW5rbm93bj4+IHwgbnVsbDsKICBhYnN0cmFjdCBuZXh0UGFnZUlu
Zm8oKTogUGFnZUluZm8gfCBudWxsOwoKICBhYnN0cmFjdCBnZXRQYWdpbmF0
ZWRJdGVtcygpOiBJdGVtW107CgogIGhhc05leHRQYWdlKCk6IGJvb2xlYW4g
ewogICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldFBhZ2luYXRlZEl0ZW1zKCk7
CiAgICBpZiAoIWl0ZW1zLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgcmV0
dXJuIHRoaXMubmV4dFBhZ2VJbmZvKCkgIT0gbnVsbDsKICB9CgogIGFzeW5j
IGdldE5leHRQYWdlKCk6IFByb21pc2U8dGhpcz4gewogICAgY29uc3QgbmV4
dEluZm8gPSB0aGlzLm5leHRQYWdlSW5mbygpOwogICAgaWYgKCFuZXh0SW5m
bykgewogICAgICB0aHJvdyBuZXcgTWVvcnBoaXNUZXN0NEVycm9yKAogICAg
ICAgICdObyBuZXh0IHBhZ2UgZXhwZWN0ZWQ7IHBsZWFzZSBjaGVjayBgLmhh
c05leHRQYWdlKClgIGJlZm9yZSBjYWxsaW5nIGAuZ2V0TmV4dFBhZ2UoKWAu
JywKICAgICAgKTsKICAgIH0KICAgIGNvbnN0IG5leHRPcHRpb25zID0geyAu
Li50aGlzLm9wdGlvbnMgfTsKICAgIGlmICgncGFyYW1zJyBpbiBuZXh0SW5m
byAmJiB0eXBlb2YgbmV4dE9wdGlvbnMucXVlcnkgPT09ICdvYmplY3QnKSB7
CiAgICAgIG5leHRPcHRpb25zLnF1ZXJ5ID0geyAuLi5uZXh0T3B0aW9ucy5x
dWVyeSwgLi4ubmV4dEluZm8ucGFyYW1zIH07CiAgICB9IGVsc2UgaWYgKCd1
cmwnIGluIG5leHRJbmZvKSB7CiAgICAgIGNvbnN0IHBhcmFtcyA9IFsuLi5P
YmplY3QuZW50cmllcyhuZXh0T3B0aW9ucy5xdWVyeSB8fCB7fSksIC4uLm5l
eHRJbmZvLnVybC5zZWFyY2hQYXJhbXMuZW50cmllcygpXTsKICAgICAgZm9y
IChjb25zdCBba2V5LCB2YWx1ZV0gb2YgcGFyYW1zKSB7CiAgICAgICAgbmV4
dEluZm8udXJsLnNlYXJjaFBhcmFtcy5zZXQoa2V5LCB2YWx1ZSBhcyBhbnkp
OwogICAgICB9CiAgICAgIG5leHRPcHRpb25zLnF1ZXJ5ID0gdW5kZWZpbmVk
OwogICAgICBuZXh0T3B0aW9ucy5wYXRoID0gbmV4dEluZm8udXJsLnRvU3Ry
aW5nKCk7CiAgICB9CiAgICByZXR1cm4gYXdhaXQgdGhpcy4jY2xpZW50LnJl
cXVlc3RBUElMaXN0KHRoaXMuY29uc3RydWN0b3IgYXMgYW55LCBuZXh0T3B0
aW9ucyk7CiAgfQoKICBhc3luYyAqaXRlclBhZ2VzKCkgewogICAgLy8gZXNs
aW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10
aGlzLWFsaWFzCiAgICBsZXQgcGFnZTogQWJzdHJhY3RQYWdlPEl0ZW0+ID0g
dGhpczsKICAgIHlpZWxkIHBhZ2U7CiAgICB3aGlsZSAocGFnZS5oYXNOZXh0
UGFnZSgpKSB7CiAgICAgIHBhZ2UgPSBhd2FpdCBwYWdlLmdldE5leHRQYWdl
KCk7CiAgICAgIHlpZWxkIHBhZ2U7CiAgICB9CiAgfQoKICBhc3luYyAqW1N5
bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHsKICAgIGZvciBhd2FpdCAoY29uc3Qg
cGFnZSBvZiB0aGlzLml0ZXJQYWdlcygpKSB7CiAgICAgIGZvciAoY29uc3Qg
aXRlbSBvZiBwYWdlLmdldFBhZ2luYXRlZEl0ZW1zKCkpIHsKICAgICAgICB5
aWVsZCBpdGVtOwogICAgICB9CiAgICB9CiAgfQp9CgovKioKICogVGhpcyBz
dWJjbGFzcyBvZiBQcm9taXNlIHdpbGwgcmVzb2x2ZSB0byBhbiBpbnN0YW50
aWF0ZWQgUGFnZSBvbmNlIHRoZSByZXF1ZXN0IGNvbXBsZXRlcy4KICoKICog
SXQgYWxzbyBpbXBsZW1lbnRzIEFzeW5jSXRlcmFibGUgdG8gYWxsb3cgYXV0
by1wYWdpbmF0aW5nIGl0ZXJhdGlvbiBvbiBhbiB1bmF3YWl0ZWQgbGlzdCBj
YWxsLCBlZzoKICoKICogICAgZm9yIGF3YWl0IChjb25zdCBpdGVtIG9mIGNs
aWVudC5pdGVtcy5saXN0KCkpIHsKICogICAgICBjb25zb2xlLmxvZyhpdGVt
KQogKiAgICB9CiAqLwpleHBvcnQgY2xhc3MgUGFnZVByb21pc2U8CiAgICBQ
YWdlQ2xhc3MgZXh0ZW5kcyBBYnN0cmFjdFBhZ2U8SXRlbT4sCiAgICBJdGVt
ID0gUmV0dXJuVHlwZTxQYWdlQ2xhc3NbJ2dldFBhZ2luYXRlZEl0ZW1zJ10+
W251bWJlcl0sCiAgPgogIGV4dGVuZHMgQVBJUHJvbWlzZTxQYWdlQ2xhc3M+
CiAgaW1wbGVtZW50cyBBc3luY0l0ZXJhYmxlPEl0ZW0+CnsKICBjb25zdHJ1
Y3RvcigKICAgIGNsaWVudDogQVBJQ2xpZW50LAogICAgcmVxdWVzdDogUHJv
bWlzZTxBUElSZXNwb25zZVByb3BzPiwKICAgIFBhZ2U6IG5ldyAoLi4uYXJn
czogQ29uc3RydWN0b3JQYXJhbWV0ZXJzPHR5cGVvZiBBYnN0cmFjdFBhZ2U+
KSA9PiBQYWdlQ2xhc3MsCiAgKSB7CiAgICBzdXBlcigKICAgICAgcmVxdWVz
dCwKICAgICAgYXN5bmMgKHByb3BzKSA9PiBuZXcgUGFnZShjbGllbnQsIHBy
b3BzLnJlc3BvbnNlLCBhd2FpdCBkZWZhdWx0UGFyc2VSZXNwb25zZShwcm9w
cyksIHByb3BzLm9wdGlvbnMpLAogICAgKTsKICB9CgogIC8qKgogICAqIEFs
bG93IGF1dG8tcGFnaW5hdGluZyBpdGVyYXRpb24gb24gYW4gdW5hd2FpdGVk
IGxpc3QgY2FsbCwgZWc6CiAgICoKICAgKiAgICBmb3IgYXdhaXQgKGNvbnN0
IGl0ZW0gb2YgY2xpZW50Lml0ZW1zLmxpc3QoKSkgewogICAqICAgICAgY29u
c29sZS5sb2coaXRlbSkKICAgKiAgICB9CiAgICovCiAgYXN5bmMgKltTeW1i
b2wuYXN5bmNJdGVyYXRvcl0oKSB7CiAgICBjb25zdCBwYWdlID0gYXdhaXQg
dGhpczsKICAgIGZvciBhd2FpdCAoY29uc3QgaXRlbSBvZiBwYWdlKSB7CiAg
ICAgIHlpZWxkIGl0ZW07CiAgICB9CiAgfQp9CgpleHBvcnQgY29uc3QgY3Jl
YXRlUmVzcG9uc2VIZWFkZXJzID0gKAogIGhlYWRlcnM6IEF3YWl0ZWQ8UmV0
dXJuVHlwZTxGZXRjaD4+WydoZWFkZXJzJ10sCik6IFJlY29yZDxzdHJpbmcs
IHN0cmluZz4gPT4gewogIHJldHVybiBuZXcgUHJveHkoCiAgICBPYmplY3Qu
ZnJvbUVudHJpZXMoCiAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgaGVhZGVy
cy5lbnRyaWVzKCksCiAgICApLAogICAgewogICAgICBnZXQodGFyZ2V0LCBu
YW1lKSB7CiAgICAgICAgY29uc3Qga2V5ID0gbmFtZS50b1N0cmluZygpOwog
ICAgICAgIHJldHVybiB0YXJnZXRba2V5LnRvTG93ZXJDYXNlKCldIHx8IHRh
cmdldFtrZXldOwogICAgICB9LAogICAgfSwKICApOwp9OwoKdHlwZSBIVFRQ
TWV0aG9kID0gJ2dldCcgfCAncG9zdCcgfCAncHV0JyB8ICdwYXRjaCcgfCAn
ZGVsZXRlJzsKCmV4cG9ydCB0eXBlIFJlcXVlc3RDbGllbnQgPSB7IGZldGNo
OiBGZXRjaCB9OwpleHBvcnQgdHlwZSBIZWFkZXJzID0gUmVjb3JkPHN0cmlu
Zywgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZD47CmV4cG9ydCB0eXBlIERl
ZmF1bHRRdWVyeSA9IFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IHVuZGVmaW5l
ZD47CmV4cG9ydCB0eXBlIEtleXNFbnVtPFQ+ID0geyBbUCBpbiBrZXlvZiBS
ZXF1aXJlZDxUPl06IHRydWUgfTsKCmV4cG9ydCB0eXBlIFJlcXVlc3RPcHRp
b25zPFJlcSA9IHVua25vd24gfCBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8
IFJlYWRhYmxlPiA9IHsKICBtZXRob2Q/OiBIVFRQTWV0aG9kOwogIHBhdGg/
OiBzdHJpbmc7CiAgcXVlcnk/OiBSZXEgfCB1bmRlZmluZWQ7CiAgYm9keT86
IFJlcSB8IG51bGwgfCB1bmRlZmluZWQ7CiAgaGVhZGVycz86IEhlYWRlcnMg
fCB1bmRlZmluZWQ7CgogIG1heFJldHJpZXM/OiBudW1iZXI7CiAgc3RyZWFt
PzogYm9vbGVhbiB8IHVuZGVmaW5lZDsKICB0aW1lb3V0PzogbnVtYmVyOwog
IGh0dHBBZ2VudD86IEFnZW50OwogIHNpZ25hbD86IEFib3J0U2lnbmFsIHwg
dW5kZWZpbmVkIHwgbnVsbDsKICBpZGVtcG90ZW5jeUtleT86IHN0cmluZzsK
CiAgX19iaW5hcnlSZXNwb25zZT86IGJvb2xlYW4gfCB1bmRlZmluZWQ7Cn07
CgovLyBUaGlzIGlzIHJlcXVpcmVkIHNvIHRoYXQgd2UgY2FuIGRldGVybWlu
ZSBpZiBhIGdpdmVuIG9iamVjdCBtYXRjaGVzIHRoZSBSZXF1ZXN0T3B0aW9u
cwovLyB0eXBlIGF0IHJ1bnRpbWUuIFdoaWxlIHRoaXMgcmVxdWlyZXMgZHVw
bGljYXRpb24sIGl0IGlzIGVuZm9yY2VkIGJ5IHRoZSBUeXBlU2NyaXB0Ci8v
IGNvbXBpbGVyIHN1Y2ggdGhhdCBhbnkgbWlzc2luZyAvIGV4dHJhbmVvdXMg
a2V5cyB3aWxsIGNhdXNlIGFuIGVycm9yLgpjb25zdCByZXF1ZXN0T3B0aW9u
c0tleXM6IEtleXNFbnVtPFJlcXVlc3RPcHRpb25zPiA9IHsKICBtZXRob2Q6
IHRydWUsCiAgcGF0aDogdHJ1ZSwKICBxdWVyeTogdHJ1ZSwKICBib2R5OiB0
cnVlLAogIGhlYWRlcnM6IHRydWUsCgogIG1heFJldHJpZXM6IHRydWUsCiAg
c3RyZWFtOiB0cnVlLAogIHRpbWVvdXQ6IHRydWUsCiAgaHR0cEFnZW50OiB0
cnVlLAogIHNpZ25hbDogdHJ1ZSwKICBpZGVtcG90ZW5jeUtleTogdHJ1ZSwK
CiAgX19iaW5hcnlSZXNwb25zZTogdHJ1ZSwKfTsKCmV4cG9ydCBjb25zdCBp
c1JlcXVlc3RPcHRpb25zID0gKG9iajogdW5rbm93bik6IG9iaiBpcyBSZXF1
ZXN0T3B0aW9ucyA9PiB7CiAgcmV0dXJuICgKICAgIHR5cGVvZiBvYmogPT09
ICdvYmplY3QnICYmCiAgICBvYmogIT09IG51bGwgJiYKICAgICFpc0VtcHR5
T2JqKG9iaikgJiYKICAgIE9iamVjdC5rZXlzKG9iaikuZXZlcnkoKGspID0+
IGhhc093bihyZXF1ZXN0T3B0aW9uc0tleXMsIGspKQogICk7Cn07CgpleHBv
cnQgdHlwZSBGaW5hbFJlcXVlc3RPcHRpb25zPFJlcSA9IHVua25vd24gfCBS
ZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IFJlYWRhYmxlPiA9IFJlcXVlc3RP
cHRpb25zPFJlcT4gJiB7CiAgbWV0aG9kOiBIVFRQTWV0aG9kOwogIHBhdGg6
IHN0cmluZzsKfTsKCmRlY2xhcmUgY29uc3QgRGVubzogYW55OwpkZWNsYXJl
IGNvbnN0IEVkZ2VSdW50aW1lOiBhbnk7CnR5cGUgQXJjaCA9ICd4MzInIHwg
J3g2NCcgfCAnYXJtJyB8ICdhcm02NCcgfCBgb3RoZXI6JHtzdHJpbmd9YCB8
ICd1bmtub3duJzsKdHlwZSBQbGF0Zm9ybU5hbWUgPQogIHwgJ01hY09TJwog
IHwgJ0xpbnV4JwogIHwgJ1dpbmRvd3MnCiAgfCAnRnJlZUJTRCcKICB8ICdP
cGVuQlNEJwogIHwgJ2lPUycKICB8ICdBbmRyb2lkJwogIHwgYE90aGVyOiR7
c3RyaW5nfWAKICB8ICdVbmtub3duJzsKdHlwZSBCcm93c2VyID0gJ2llJyB8
ICdlZGdlJyB8ICdjaHJvbWUnIHwgJ2ZpcmVmb3gnIHwgJ3NhZmFyaSc7CnR5
cGUgUGxhdGZvcm1Qcm9wZXJ0aWVzID0gewogICdYLVN0YWlubGVzcy1MYW5n
JzogJ2pzJzsKICAnWC1TdGFpbmxlc3MtUGFja2FnZS1WZXJzaW9uJzogc3Ry
aW5nOwogICdYLVN0YWlubGVzcy1PUyc6IFBsYXRmb3JtTmFtZTsKICAnWC1T
dGFpbmxlc3MtQXJjaCc6IEFyY2g7CiAgJ1gtU3RhaW5sZXNzLVJ1bnRpbWUn
OiAnbm9kZScgfCAnZGVubycgfCAnZWRnZScgfCBgYnJvd3Nlcjoke0Jyb3dz
ZXJ9YCB8ICd1bmtub3duJzsKICAnWC1TdGFpbmxlc3MtUnVudGltZS1WZXJz
aW9uJzogc3RyaW5nOwp9Owpjb25zdCBnZXRQbGF0Zm9ybVByb3BlcnRpZXMg
PSAoKTogUGxhdGZvcm1Qcm9wZXJ0aWVzID0+IHsKICBpZiAodHlwZW9mIERl
bm8gIT09ICd1bmRlZmluZWQnICYmIERlbm8uYnVpbGQgIT0gbnVsbCkgewog
ICAgcmV0dXJuIHsKICAgICAgJ1gtU3RhaW5sZXNzLUxhbmcnOiAnanMnLAog
ICAgICAnWC1TdGFpbmxlc3MtUGFja2FnZS1WZXJzaW9uJzogVkVSU0lPTiwK
ICAgICAgJ1gtU3RhaW5sZXNzLU9TJzogbm9ybWFsaXplUGxhdGZvcm0oRGVu
by5idWlsZC5vcyksCiAgICAgICdYLVN0YWlubGVzcy1BcmNoJzogbm9ybWFs
aXplQXJjaChEZW5vLmJ1aWxkLmFyY2gpLAogICAgICAnWC1TdGFpbmxlc3Mt
UnVudGltZSc6ICdkZW5vJywKICAgICAgJ1gtU3RhaW5sZXNzLVJ1bnRpbWUt
VmVyc2lvbic6IERlbm8udmVyc2lvbiwKICAgIH07CiAgfQogIGlmICh0eXBl
b2YgRWRnZVJ1bnRpbWUgIT09ICd1bmRlZmluZWQnKSB7CiAgICByZXR1cm4g
ewogICAgICAnWC1TdGFpbmxlc3MtTGFuZyc6ICdqcycsCiAgICAgICdYLVN0
YWlubGVzcy1QYWNrYWdlLVZlcnNpb24nOiBWRVJTSU9OLAogICAgICAnWC1T
dGFpbmxlc3MtT1MnOiAnVW5rbm93bicsCiAgICAgICdYLVN0YWlubGVzcy1B
cmNoJzogYG90aGVyOiR7RWRnZVJ1bnRpbWV9YCwKICAgICAgJ1gtU3RhaW5s
ZXNzLVJ1bnRpbWUnOiAnZWRnZScsCiAgICAgICdYLVN0YWlubGVzcy1SdW50
aW1lLVZlcnNpb24nOiBwcm9jZXNzLnZlcnNpb24sCiAgICB9OwogIH0KICAv
LyBDaGVjayBpZiBOb2RlLmpzCiAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9T
dHJpbmcuY2FsbCh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgPyBw
cm9jZXNzIDogMCkgPT09ICdbb2JqZWN0IHByb2Nlc3NdJykgewogICAgcmV0
dXJuIHsKICAgICAgJ1gtU3RhaW5sZXNzLUxhbmcnOiAnanMnLAogICAgICAn
WC1TdGFpbmxlc3MtUGFja2FnZS1WZXJzaW9uJzogVkVSU0lPTiwKICAgICAg
J1gtU3RhaW5sZXNzLU9TJzogbm9ybWFsaXplUGxhdGZvcm0ocHJvY2Vzcy5w
bGF0Zm9ybSksCiAgICAgICdYLVN0YWlubGVzcy1BcmNoJzogbm9ybWFsaXpl
QXJjaChwcm9jZXNzLmFyY2gpLAogICAgICAnWC1TdGFpbmxlc3MtUnVudGlt
ZSc6ICdub2RlJywKICAgICAgJ1gtU3RhaW5sZXNzLVJ1bnRpbWUtVmVyc2lv
bic6IHByb2Nlc3MudmVyc2lvbiwKICAgIH07CiAgfQoKICBjb25zdCBicm93
c2VySW5mbyA9IGdldEJyb3dzZXJJbmZvKCk7CiAgaWYgKGJyb3dzZXJJbmZv
KSB7CiAgICByZXR1cm4gewogICAgICAnWC1TdGFpbmxlc3MtTGFuZyc6ICdq
cycsCiAgICAgICdYLVN0YWlubGVzcy1QYWNrYWdlLVZlcnNpb24nOiBWRVJT
SU9OLAogICAgICAnWC1TdGFpbmxlc3MtT1MnOiAnVW5rbm93bicsCiAgICAg
ICdYLVN0YWlubGVzcy1BcmNoJzogJ3Vua25vd24nLAogICAgICAnWC1TdGFp
bmxlc3MtUnVudGltZSc6IGBicm93c2VyOiR7YnJvd3NlckluZm8uYnJvd3Nl
cn1gLAogICAgICAnWC1TdGFpbmxlc3MtUnVudGltZS1WZXJzaW9uJzogYnJv
d3NlckluZm8udmVyc2lvbiwKICAgIH07CiAgfQoKICAvLyBUT0RPIGFkZCBz
dXBwb3J0IGZvciBDbG91ZGZsYXJlIHdvcmtlcnMsIGV0Yy4KICByZXR1cm4g
ewogICAgJ1gtU3RhaW5sZXNzLUxhbmcnOiAnanMnLAogICAgJ1gtU3RhaW5s
ZXNzLVBhY2thZ2UtVmVyc2lvbic6IFZFUlNJT04sCiAgICAnWC1TdGFpbmxl
c3MtT1MnOiAnVW5rbm93bicsCiAgICAnWC1TdGFpbmxlc3MtQXJjaCc6ICd1
bmtub3duJywKICAgICdYLVN0YWlubGVzcy1SdW50aW1lJzogJ3Vua25vd24n
LAogICAgJ1gtU3RhaW5sZXNzLVJ1bnRpbWUtVmVyc2lvbic6ICd1bmtub3du
JywKICB9Owp9OwoKdHlwZSBCcm93c2VySW5mbyA9IHsKICBicm93c2VyOiBC
cm93c2VyOwogIHZlcnNpb246IHN0cmluZzsKfTsKCmRlY2xhcmUgY29uc3Qg
bmF2aWdhdG9yOiB7IHVzZXJBZ2VudDogc3RyaW5nIH0gfCB1bmRlZmluZWQ7
CgovLyBOb3RlOiBtb2RpZmllZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9K
Uy1EZXZUb29scy9ob3N0LWVudmlyb25tZW50L2Jsb2IvYjFhYjc5ZWNkZTM3
ZGI1ZDZlMTYzYzA1MGU1NGZlN2QyODdkN2M5Mi9zcmMvaXNvbW9ycGhpYy5i
cm93c2VyLnRzCmZ1bmN0aW9uIGdldEJyb3dzZXJJbmZvKCk6IEJyb3dzZXJJ
bmZvIHwgbnVsbCB7CiAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRl
ZmluZWQnIHx8ICFuYXZpZ2F0b3IpIHsKICAgIHJldHVybiBudWxsOwogIH0K
CiAgLy8gTk9URTogVGhlIG9yZGVyIG1hdHRlcnMgaGVyZSEKICBjb25zdCBi
cm93c2VyUGF0dGVybnMgPSBbCiAgICB7IGtleTogJ2VkZ2UnIGFzIGNvbnN0
LCBwYXR0ZXJuOiAvRWRnZSg/OlxXKyhcZCspXC4oXGQrKSg/OlwuKFxkKykp
Pyk/LyB9LAogICAgeyBrZXk6ICdpZScgYXMgY29uc3QsIHBhdHRlcm46IC9N
U0lFKD86XFcrKFxkKylcLihcZCspKD86XC4oXGQrKSk/KT8vIH0sCiAgICB7
IGtleTogJ2llJyBhcyBjb25zdCwgcGF0dGVybjogL1RyaWRlbnQoPzouKnJ2
XDooXGQrKVwuKFxkKykoPzpcLihcZCspKT8pPy8gfSwKICAgIHsga2V5OiAn
Y2hyb21lJyBhcyBjb25zdCwgcGF0dGVybjogL0Nocm9tZSg/OlxXKyhcZCsp
XC4oXGQrKSg/OlwuKFxkKykpPyk/LyB9LAogICAgeyBrZXk6ICdmaXJlZm94
JyBhcyBjb25zdCwgcGF0dGVybjogL0ZpcmVmb3goPzpcVysoXGQrKVwuKFxk
KykoPzpcLihcZCspKT8pPy8gfSwKICAgIHsga2V5OiAnc2FmYXJpJyBhcyBj
b25zdCwgcGF0dGVybjogLyg/OlZlcnNpb25cVysoXGQrKVwuKFxkKykoPzpc
LihcZCspKT8pPyg/OlxXK01vYmlsZVxTKik/XFcrU2FmYXJpLyB9LAogIF07
CgogIC8vIEZpbmQgdGhlIEZJUlNUIG1hdGNoaW5nIGJyb3dzZXIKICBmb3Ig
KGNvbnN0IHsga2V5LCBwYXR0ZXJuIH0gb2YgYnJvd3NlclBhdHRlcm5zKSB7
CiAgICBjb25zdCBtYXRjaCA9IHBhdHRlcm4uZXhlYyhuYXZpZ2F0b3IudXNl
ckFnZW50KTsKICAgIGlmIChtYXRjaCkgewogICAgICBjb25zdCBtYWpvciA9
IG1hdGNoWzFdIHx8IDA7CiAgICAgIGNvbnN0IG1pbm9yID0gbWF0Y2hbMl0g
fHwgMDsKICAgICAgY29uc3QgcGF0Y2ggPSBtYXRjaFszXSB8fCAwOwoKICAg
ICAgcmV0dXJuIHsgYnJvd3Nlcjoga2V5LCB2ZXJzaW9uOiBgJHttYWpvcn0u
JHttaW5vcn0uJHtwYXRjaH1gIH07CiAgICB9CiAgfQoKICByZXR1cm4gbnVs
bDsKfQoKY29uc3Qgbm9ybWFsaXplQXJjaCA9IChhcmNoOiBzdHJpbmcpOiBB
cmNoID0+IHsKICAvLyBOb2RlIGRvY3M6CiAgLy8gLSBodHRwczovL25vZGVq
cy5vcmcvYXBpL3Byb2Nlc3MuaHRtbCNwcm9jZXNzYXJjaAogIC8vIERlbm8g
ZG9jczoKICAvLyAtIGh0dHBzOi8vZG9jLmRlbm8ubGFuZC9kZW5vL3N0YWJs
ZS9+L0Rlbm8uYnVpbGQKICBpZiAoYXJjaCA9PT0gJ3gzMicpIHJldHVybiAn
eDMyJzsKICBpZiAoYXJjaCA9PT0gJ3g4Nl82NCcgfHwgYXJjaCA9PT0gJ3g2
NCcpIHJldHVybiAneDY0JzsKICBpZiAoYXJjaCA9PT0gJ2FybScpIHJldHVy
biAnYXJtJzsKICBpZiAoYXJjaCA9PT0gJ2FhcmNoNjQnIHx8IGFyY2ggPT09
ICdhcm02NCcpIHJldHVybiAnYXJtNjQnOwogIGlmIChhcmNoKSByZXR1cm4g
YG90aGVyOiR7YXJjaH1gOwogIHJldHVybiAndW5rbm93bic7Cn07Cgpjb25z
dCBub3JtYWxpemVQbGF0Zm9ybSA9IChwbGF0Zm9ybTogc3RyaW5nKTogUGxh
dGZvcm1OYW1lID0+IHsKICAvLyBOb2RlIHBsYXRmb3JtczoKICAvLyAtIGh0
dHBzOi8vbm9kZWpzLm9yZy9hcGkvcHJvY2Vzcy5odG1sI3Byb2Nlc3NwbGF0
Zm9ybQogIC8vIERlbm8gcGxhdGZvcm1zOgogIC8vIC0gaHR0cHM6Ly9kb2Mu
ZGVuby5sYW5kL2Rlbm8vc3RhYmxlL34vRGVuby5idWlsZAogIC8vIC0gaHR0
cHM6Ly9naXRodWIuY29tL2Rlbm9sYW5kL2Rlbm8vaXNzdWVzLzE0Nzk5Cgog
IHBsYXRmb3JtID0gcGxhdGZvcm0udG9Mb3dlckNhc2UoKTsKCiAgLy8gTk9U
RTogdGhpcyBpT1MgY2hlY2sgaXMgdW50ZXN0ZWQgYW5kIG1heSBub3Qgd29y
awogIC8vIE5vZGUgZG9lcyBub3Qgd29yayBuYXRpdmVseSBvbiBJT1MsIHRo
ZXJlIGlzIGEgZm9yayBhdAogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2Rl
anMtbW9iaWxlL25vZGVqcy1tb2JpbGUKICAvLyBob3dldmVyIGl0IGlzIHVu
a25vd24gYXQgdGhlIHRpbWUgb2Ygd3JpdGluZyBob3cgdG8gZGV0ZWN0IGlm
IGl0IGlzIHJ1bm5pbmcKICBpZiAocGxhdGZvcm0uaW5jbHVkZXMoJ2lvcycp
KSByZXR1cm4gJ2lPUyc7CiAgaWYgKHBsYXRmb3JtID09PSAnYW5kcm9pZCcp
IHJldHVybiAnQW5kcm9pZCc7CiAgaWYgKHBsYXRmb3JtID09PSAnZGFyd2lu
JykgcmV0dXJuICdNYWNPUyc7CiAgaWYgKHBsYXRmb3JtID09PSAnd2luMzIn
KSByZXR1cm4gJ1dpbmRvd3MnOwogIGlmIChwbGF0Zm9ybSA9PT0gJ2ZyZWVi
c2QnKSByZXR1cm4gJ0ZyZWVCU0QnOwogIGlmIChwbGF0Zm9ybSA9PT0gJ29w
ZW5ic2QnKSByZXR1cm4gJ09wZW5CU0QnOwogIGlmIChwbGF0Zm9ybSA9PT0g
J2xpbnV4JykgcmV0dXJuICdMaW51eCc7CiAgaWYgKHBsYXRmb3JtKSByZXR1
cm4gYE90aGVyOiR7cGxhdGZvcm19YDsKICByZXR1cm4gJ1Vua25vd24nOwp9
OwoKbGV0IF9wbGF0Zm9ybUhlYWRlcnM6IFBsYXRmb3JtUHJvcGVydGllczsK
Y29uc3QgZ2V0UGxhdGZvcm1IZWFkZXJzID0gKCkgPT4gewogIHJldHVybiAo
X3BsYXRmb3JtSGVhZGVycyA/Pz0gZ2V0UGxhdGZvcm1Qcm9wZXJ0aWVzKCkp
Owp9OwoKZXhwb3J0IGNvbnN0IHNhZmVKU09OID0gKHRleHQ6IHN0cmluZykg
PT4gewogIHRyeSB7CiAgICByZXR1cm4gSlNPTi5wYXJzZSh0ZXh0KTsKICB9
IGNhdGNoIChlcnIpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQp9OwoK
Ly8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE5NzA5ODQ2CmNvbnN0
IHN0YXJ0c1dpdGhTY2hlbWVSZWdleHAgPSBuZXcgUmVnRXhwKCdeKD86W2Et
el0rOik/Ly8nLCAnaScpOwpjb25zdCBpc0Fic29sdXRlVVJMID0gKHVybDog
c3RyaW5nKTogYm9vbGVhbiA9PiB7CiAgcmV0dXJuIHN0YXJ0c1dpdGhTY2hl
bWVSZWdleHAudGVzdCh1cmwpOwp9OwoKZXhwb3J0IGNvbnN0IHNsZWVwID0g
KG1zOiBudW1iZXIpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRU
aW1lb3V0KHJlc29sdmUsIG1zKSk7Cgpjb25zdCB2YWxpZGF0ZVBvc2l0aXZl
SW50ZWdlciA9IChuYW1lOiBzdHJpbmcsIG46IHVua25vd24pOiBudW1iZXIg
PT4gewogIGlmICh0eXBlb2YgbiAhPT0gJ251bWJlcicgfHwgIU51bWJlci5p
c0ludGVnZXIobikpIHsKICAgIHRocm93IG5ldyBNZW9ycGhpc1Rlc3Q0RXJy
b3IoYCR7bmFtZX0gbXVzdCBiZSBhbiBpbnRlZ2VyYCk7CiAgfQogIGlmIChu
IDwgMCkgewogICAgdGhyb3cgbmV3IE1lb3JwaGlzVGVzdDRFcnJvcihgJHtu
YW1lfSBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlcmApOwogIH0KICByZXR1
cm4gbjsKfTsKCmV4cG9ydCBjb25zdCBjYXN0VG9FcnJvciA9IChlcnI6IGFu
eSk6IEVycm9yID0+IHsKICBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IpIHJl
dHVybiBlcnI7CiAgcmV0dXJuIG5ldyBFcnJvcihlcnIpOwp9OwoKZXhwb3J0
IGNvbnN0IGVuc3VyZVByZXNlbnQgPSA8VD4odmFsdWU6IFQgfCBudWxsIHwg
dW5kZWZpbmVkKTogVCA9PiB7CiAgaWYgKHZhbHVlID09IG51bGwpCiAgICB0
aHJvdyBuZXcgTWVvcnBoaXNUZXN0NEVycm9yKGBFeHBlY3RlZCBhIHZhbHVl
IHRvIGJlIGdpdmVuIGJ1dCByZWNlaXZlZCAke3ZhbHVlfSBpbnN0ZWFkLmAp
OwogIHJldHVybiB2YWx1ZTsKfTsKCi8qKgogKiBSZWFkIGFuIGVudmlyb25t
ZW50IHZhcmlhYmxlLgogKgogKiBUcmltcyBiZWdpbm5pbmcgYW5kIHRyYWls
aW5nIHdoaXRlc3BhY2UuCiAqCiAqIFdpbGwgcmV0dXJuIHVuZGVmaW5lZCBp
ZiB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGUgZG9lc24ndCBleGlzdCBvciBj
YW5ub3QgYmUgYWNjZXNzZWQuCiAqLwpleHBvcnQgY29uc3QgcmVhZEVudiA9
IChlbnY6IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7CiAgaWYg
KHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJykgewogICAgcmV0dXJu
IHByb2Nlc3MuZW52Py5bZW52XT8udHJpbSgpID8/IHVuZGVmaW5lZDsKICB9
CiAgaWYgKHR5cGVvZiBEZW5vICE9PSAndW5kZWZpbmVkJykgewogICAgcmV0
dXJuIERlbm8uZW52Py5nZXQ/LihlbnYpPy50cmltKCk7CiAgfQogIHJldHVy
biB1bmRlZmluZWQ7Cn07CgpleHBvcnQgY29uc3QgY29lcmNlSW50ZWdlciA9
ICh2YWx1ZTogdW5rbm93bik6IG51bWJlciA9PiB7CiAgaWYgKHR5cGVvZiB2
YWx1ZSA9PT0gJ251bWJlcicpIHJldHVybiBNYXRoLnJvdW5kKHZhbHVlKTsK
ICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgcmV0dXJuIHBhcnNl
SW50KHZhbHVlLCAxMCk7CgogIHRocm93IG5ldyBNZW9ycGhpc1Rlc3Q0RXJy
b3IoYENvdWxkIG5vdCBjb2VyY2UgJHt2YWx1ZX0gKHR5cGU6ICR7dHlwZW9m
IHZhbHVlfSkgaW50byBhIG51bWJlcmApOwp9OwoKZXhwb3J0IGNvbnN0IGNv
ZXJjZUZsb2F0ID0gKHZhbHVlOiB1bmtub3duKTogbnVtYmVyID0+IHsKICBp
ZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykgcmV0dXJuIHZhbHVlOwog
IGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSByZXR1cm4gcGFyc2VG
bG9hdCh2YWx1ZSk7CgogIHRocm93IG5ldyBNZW9ycGhpc1Rlc3Q0RXJyb3Io
YENvdWxkIG5vdCBjb2VyY2UgJHt2YWx1ZX0gKHR5cGU6ICR7dHlwZW9mIHZh
bHVlfSkgaW50byBhIG51bWJlcmApOwp9OwoKZXhwb3J0IGNvbnN0IGNvZXJj
ZUJvb2xlYW4gPSAodmFsdWU6IHVua25vd24pOiBib29sZWFuID0+IHsKICBp
ZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHJldHVybiB2YWx1ZTsK
ICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgcmV0dXJuIHZhbHVl
ID09PSAndHJ1ZSc7CiAgcmV0dXJuIEJvb2xlYW4odmFsdWUpOwp9OwoKZXhw
b3J0IGNvbnN0IG1heWJlQ29lcmNlSW50ZWdlciA9ICh2YWx1ZTogdW5rbm93
bik6IG51bWJlciB8IHVuZGVmaW5lZCA9PiB7CiAgaWYgKHZhbHVlID09PSB1
bmRlZmluZWQpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHJldHVy
biBjb2VyY2VJbnRlZ2VyKHZhbHVlKTsKfTsKCmV4cG9ydCBjb25zdCBtYXli
ZUNvZXJjZUZsb2F0ID0gKHZhbHVlOiB1bmtub3duKTogbnVtYmVyIHwgdW5k
ZWZpbmVkID0+IHsKICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAg
cmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgcmV0dXJuIGNvZXJjZUZsb2F0KHZh
bHVlKTsKfTsKCmV4cG9ydCBjb25zdCBtYXliZUNvZXJjZUJvb2xlYW4gPSAo
dmFsdWU6IHVua25vd24pOiBib29sZWFuIHwgdW5kZWZpbmVkID0+IHsKICBp
ZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHVuZGVmaW5l
ZDsKICB9CiAgcmV0dXJuIGNvZXJjZUJvb2xlYW4odmFsdWUpOwp9OwoKLy8g
aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM0NDkxMjg3CmV4cG9ydCBm
dW5jdGlvbiBpc0VtcHR5T2JqKG9iajogT2JqZWN0IHwgbnVsbCB8IHVuZGVm
aW5lZCk6IGJvb2xlYW4gewogIGlmICghb2JqKSByZXR1cm4gdHJ1ZTsKICBm
b3IgKGNvbnN0IF9rIGluIG9iaikgcmV0dXJuIGZhbHNlOwogIHJldHVybiB0
cnVlOwp9CgovLyBodHRwczovL2VzbGludC5vcmcvZG9jcy9sYXRlc3QvcnVs
ZXMvbm8tcHJvdG90eXBlLWJ1aWx0aW5zCmV4cG9ydCBmdW5jdGlvbiBoYXNP
d24ob2JqOiBPYmplY3QsIGtleTogc3RyaW5nKTogYm9vbGVhbiB7CiAgcmV0
dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmos
IGtleSk7Cn0KCi8qKgogKiBDb3BpZXMgaGVhZGVycyBmcm9tICJuZXdIZWFk
ZXJzIiBvbnRvICJ0YXJnZXRIZWFkZXJzIiwKICogdXNpbmcgbG93ZXItY2Fz
ZSBmb3IgYWxsIHByb3BlcnRpZXMsCiAqIGlnbm9yaW5nIGFueSBrZXlzIHdp
dGggdW5kZWZpbmVkIHZhbHVlcywKICogYW5kIGRlbGV0aW5nIGFueSBrZXlz
IHdpdGggbnVsbCB2YWx1ZXMuCiAqLwpmdW5jdGlvbiBhcHBseUhlYWRlcnNN
dXQodGFyZ2V0SGVhZGVyczogSGVhZGVycywgbmV3SGVhZGVyczogSGVhZGVy
cyk6IHZvaWQgewogIGZvciAoY29uc3QgayBpbiBuZXdIZWFkZXJzKSB7CiAg
ICBpZiAoIWhhc093bihuZXdIZWFkZXJzLCBrKSkgY29udGludWU7CiAgICBj
b25zdCBsb3dlcktleSA9IGsudG9Mb3dlckNhc2UoKTsKICAgIGlmICghbG93
ZXJLZXkpIGNvbnRpbnVlOwoKICAgIGNvbnN0IHZhbCA9IG5ld0hlYWRlcnNb
a107CgogICAgaWYgKHZhbCA9PT0gbnVsbCkgewogICAgICBkZWxldGUgdGFy
Z2V0SGVhZGVyc1tsb3dlcktleV07CiAgICB9IGVsc2UgaWYgKHZhbCAhPT0g
dW5kZWZpbmVkKSB7CiAgICAgIHRhcmdldEhlYWRlcnNbbG93ZXJLZXldID0g
dmFsOwogICAgfQogIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGRlYnVnKGFjdGlv
bjogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkgewogIGlmICh0eXBlb2YgcHJv
Y2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvY2Vzcy5lbnZbJ0RFQlVHJ10g
PT09ICd0cnVlJykgewogICAgY29uc29sZS5sb2coYE1lb3JwaGlzVGVzdDQ6
REVCVUc6JHthY3Rpb259YCwgLi4uYXJncyk7CiAgfQp9CgovKioKICogaHR0
cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzIxMTc1MjMKICovCmNvbnN0IHV1
aWQ0ID0gKCkgPT4gewogIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4
eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIChjKSA9PiB7CiAg
ICBjb25zdCByID0gKE1hdGgucmFuZG9tKCkgKiAxNikgfCAwOwogICAgY29u
c3QgdiA9IGMgPT09ICd4JyA/IHIgOiAociAmIDB4MykgfCAweDg7CiAgICBy
ZXR1cm4gdi50b1N0cmluZygxNik7CiAgfSk7Cn07CgpleHBvcnQgY29uc3Qg
aXNSdW5uaW5nSW5Ccm93c2VyID0gKCkgPT4gewogIHJldHVybiAoCiAgICAv
LyBAdHMtaWdub3JlCiAgICB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVk
JyAmJgogICAgLy8gQHRzLWlnbm9yZQogICAgdHlwZW9mIHdpbmRvdy5kb2N1
bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYKICAgIC8vIEB0cy1pZ25vcmUKICAg
IHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnCiAgKTsKfTsKCmV4
cG9ydCBpbnRlcmZhY2UgSGVhZGVyc1Byb3RvY29sIHsKICBnZXQ6IChoZWFk
ZXI6IHN0cmluZykgPT4gc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZDsKfQpl
eHBvcnQgdHlwZSBIZWFkZXJzTGlrZSA9IFJlY29yZDxzdHJpbmcsIHN0cmlu
ZyB8IHN0cmluZ1tdIHwgdW5kZWZpbmVkPiB8IEhlYWRlcnNQcm90b2NvbDsK
CmV4cG9ydCBjb25zdCBpc0hlYWRlcnNQcm90b2NvbCA9IChoZWFkZXJzOiBh
bnkpOiBoZWFkZXJzIGlzIEhlYWRlcnNQcm90b2NvbCA9PiB7CiAgcmV0dXJu
IHR5cGVvZiBoZWFkZXJzPy5nZXQgPT09ICdmdW5jdGlvbic7Cn07CgpleHBv
cnQgY29uc3QgZ2V0UmVxdWlyZWRIZWFkZXIgPSAoaGVhZGVyczogSGVhZGVy
c0xpa2UsIGhlYWRlcjogc3RyaW5nKTogc3RyaW5nID0+IHsKICBjb25zdCBs
b3dlckNhc2VkSGVhZGVyID0gaGVhZGVyLnRvTG93ZXJDYXNlKCk7CiAgaWYg
KGlzSGVhZGVyc1Byb3RvY29sKGhlYWRlcnMpKSB7CiAgICAvLyB0byBkZWFs
IHdpdGggdGhlIGNhc2Ugd2hlcmUgdGhlIGhlYWRlciBsb29rcyBsaWtlIFN0
YWlubGVzcy1FdmVudC1JZAogICAgY29uc3QgaW50ZXJjYXBzSGVhZGVyID0K
ICAgICAgaGVhZGVyWzBdPy50b1VwcGVyQ2FzZSgpICsKICAgICAgaGVhZGVy
LnN1YnN0cmluZygxKS5yZXBsYWNlKC8oW15cd10pKFx3KS9nLCAoX20sIGcx
LCBnMikgPT4gZzEgKyBnMi50b1VwcGVyQ2FzZSgpKTsKICAgIGZvciAoY29u
c3Qga2V5IG9mIFtoZWFkZXIsIGxvd2VyQ2FzZWRIZWFkZXIsIGhlYWRlci50
b1VwcGVyQ2FzZSgpLCBpbnRlcmNhcHNIZWFkZXJdKSB7CiAgICAgIGNvbnN0
IHZhbHVlID0gaGVhZGVycy5nZXQoa2V5KTsKICAgICAgaWYgKHZhbHVlKSB7
CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICB9CiAgfQoKICBm
b3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhoZWFk
ZXJzKSkgewogICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09PSBsb3dlckNh
c2VkSGVhZGVyKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkg
ewogICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPD0gMSkgcmV0dXJuIHZhbHVl
WzBdOwogICAgICAgIGNvbnNvbGUud2FybihgUmVjZWl2ZWQgJHt2YWx1ZS5s
ZW5ndGh9IGVudHJpZXMgZm9yIHRoZSAke2hlYWRlcn0gaGVhZGVyLCB1c2lu
ZyB0aGUgZmlyc3QgZW50cnkuYCk7CiAgICAgICAgcmV0dXJuIHZhbHVlWzBd
OwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICB9CgogIHRo
cm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgJHtoZWFkZXJ9IGhlYWRl
cmApOwp9OwoKLyoqCiAqIEVuY29kZXMgYSBzdHJpbmcgdG8gQmFzZTY0IGZv
cm1hdC4KICovCmV4cG9ydCBjb25zdCB0b0Jhc2U2NCA9IChzdHI6IHN0cmlu
ZyB8IG51bGwgfCB1bmRlZmluZWQpOiBzdHJpbmcgPT4gewogIGlmICghc3Ry
KSByZXR1cm4gJyc7CiAgaWYgKHR5cGVvZiBCdWZmZXIgIT09ICd1bmRlZmlu
ZWQnKSB7CiAgICByZXR1cm4gQnVmZmVyLmZyb20oc3RyKS50b1N0cmluZygn
YmFzZTY0Jyk7CiAgfQoKICBpZiAodHlwZW9mIGJ0b2EgIT09ICd1bmRlZmlu
ZWQnKSB7CiAgICByZXR1cm4gYnRvYShzdHIpOwogIH0KCiAgdGhyb3cgbmV3
IE1lb3JwaGlzVGVzdDRFcnJvcignQ2Fubm90IGdlbmVyYXRlIGI2NCBzdHJp
bmc7IEV4cGVjdGVkIGBCdWZmZXJgIG9yIGBidG9hYCB0byBiZSBkZWZpbmVk
Jyk7Cn07CgpleHBvcnQgZnVuY3Rpb24gaXNPYmoob2JqOiB1bmtub3duKTog
b2JqIGlzIFJlY29yZDxzdHJpbmcsIHVua25vd24+IHsKICByZXR1cm4gb2Jq
ICE9IG51bGwgJiYgdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgIUFycmF5
LmlzQXJyYXkob2JqKTsKfQo=
